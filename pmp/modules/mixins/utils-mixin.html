<link rel="import" href="../../../bower_components/etools-behaviors/etools-logs-mixin.html">
<script>
  (function() {
    'use strict';

    window.EtoolsPmpApp = window.EtoolsPmpApp || {};
    window.EtoolsPmpApp.Mixins = window.EtoolsPmpApp.Mixins || {};

    /**
     * @polymer
     * @mixinFunction
     * @appliesMixin EtoolsLogsMixin
     */
    EtoolsPmpApp.Mixins.Utils = baseClass => class extends EtoolsLogsMixin(baseClass) {

      _equals(a, b) {
        return a === b;
      }

      _toNumber(val) {
        return Number(val);
      }

      _formatNumber(val, placeholder, decimals, thousandsPoint, decimalsPoint) {
        placeholder = placeholder ? placeholder : '-';

        let nr = Number(val);
        if (isNaN(nr)) {
          return placeholder;
        }

        decimals = !isNaN(decimals) ? Number(decimals) : 2;
        nr = nr.toFixed(decimals);

        decimalsPoint = decimalsPoint ? decimalsPoint : '.';
        thousandsPoint = thousandsPoint ? thousandsPoint : '';

        if (decimalsPoint && thousandsPoint && decimalsPoint === thousandsPoint) {
          this.logWarn('thousandsPoint and decimalsPoint should be different', 'utils-mixin');
          return nr;
        }
        let nrParts = nr.split('.');
        if (thousandsPoint) {
          let thousandsRegex = new RegExp('(\\d)(?=(\\d{3})+(?!\\d))', 'g');
          nrParts[0] = nrParts[0].replace(thousandsRegex, '$1' + thousandsPoint);
        }
        return nrParts.join(decimalsPoint);
      }

      _capitalizeFirstLetter(text) {
        if (text) {
          return text[0].toUpperCase() + text.substring(1);
        }
      }

      _deferred() {
        let defer = {};

        defer.promise = new Promise(function(resolve, reject) {
          defer.resolve = resolve;
          defer.reject = reject;
        });

        return defer;
      }

      _toPercentage(value) {
        return value == null /* undefinded & null */ ? // jshint ignore:line
            value : Math.floor(value * 100) + '%';
      }

      _fieldsAreValid() {
        let valid = true;
        let fields = [].slice.call(
            this.shadowRoot.querySelectorAll('.validate')
        );
        // NOTE: NodeList.forEach is not supported by older browsers(min IE11),
        // using Array.prototype.forEach.call instead
        Array.prototype.forEach.call(fields, function(field) {
          if (!field.validate()) {
            valid = false;
          }
        });

        return valid;
      }

      _ternary(value, expected, value1, value2) {
        return (value === expected) ? value1 : value2;
      }

      _withDefault(value, defaultValue) {
        if (typeof defaultValue === 'undefined') {
          defaultValue = '-';
        }
        return value ? value : defaultValue;
      }

       _formatIndicatorValue(displayType, value) {
        if (value == null) {
          return value;
        }

         switch (displayType) {
          case 'percentage':
            return this._formatNumber(value, '-', 2, '\,') + '%';
          case 'ratio':
            return this._formatNumber(value, '-', 2, '\,') + ':1';
          case 'number':
            return this._formatNumber(value, '-', 0, '\,');
          default:
            return value;
        }
      }

      // For simple objects, no nesting
      objectsAreTheSame(obj1, obj2) {
        if (obj1 === obj2) {
          return true;
        }
        if (!obj1 && !obj2) {
          return false;
        }
        let props1 = Object.keys(obj1);
        let props2 = Object.keys(obj2);

        if (props1.length !== props2.length) {
          return false;
        }
        if (props1.length === 0) {
          return true;
        }

        let areDiff = false;
        props1.forEach(p => {
          if( obj1[p] !== obj2[p]) {
            areDiff = true;
          }
        });
        return areDiff;
      }

    };

  }());
</script>

