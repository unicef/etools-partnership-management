<link rel="import" href="../redux/etools-data-redux-store.html">
<link rel="import" href="../endpoints/endpoints.html">
<script>
  (function() {
    'use strict';

    window.EtoolsPmpApp = window.EtoolsPmpApp || {};
    window.EtoolsPmpApp.Mixins = window.EtoolsPmpApp.Mixins || {};

    /**
     * @polymer
     * @mixinFunction
     * @appliesMixin EtoolsPmpApp.Mixins.EtoolsDataReduxStore
     */
    EtoolsPmpApp.Mixins.Uploads = baseClass => class extends EtoolsPmpApp.Mixins.EtoolsDataReduxStore(baseClass) {
      static get properties() {
        return {
          uploadEndpoint: {
            type: String,
            value: function() {
              return EtoolsPmpApp.Endpoints.attachmentsUpload.url;
            }
          },
          uploadsInProgress: {
            type: Number,
            statePath: 'uploadsInProgress'
          },
          unsavedUploads: {
            type: Boolean,
            statePath: 'unsavedUploads'
          }
        };
      }

      static get actions() {
        return {
          increaseUploadsInProgress: function() {
            return {
              type: 'INCREASE_UPLOADS_IN_PROGRESS'
            };
          },
          decreaseUploadsInProgress: function() {
            return {
              type: 'DECREASE_UPLOADS_IN_PROGRESS'
            };
          },
          increaseUnsavedUploads: function() {
            return {
              type: 'INCREASE_UNSAVED_UPLOADS'
            };
          },
          decreaseUnsavedUploads: function() {
            return {
              type: 'DECREASE_UNSAVED_UPLOADS'
            };
          },
          resetUploadsInProgress: function() {
            return {
              type: 'RESET_UPLOADS_IN_PROGRESS'
            };
          },
          resetUnsavedUploads: function() {
            return {
              type: 'RESET_UNSAVED_UPLOADS'
            };
          }
        };
      }

      _onUploadStarted(e) {
        e.stopImmediatePropagation();
        this.dispatch('increaseUploadsInProgress');
      }

      _onChangeUnsavedFile(e) {
        e.stopImmediatePropagation();
        this.dispatch('decreaseUnsavedUploads');
      }
   };

  }());
</script>
