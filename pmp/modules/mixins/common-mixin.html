<link rel="import" href="date-mixin.html">
<link rel="import" href="../scripts/lodash.html">
<script>
  window.EtoolsPmpApp = window.EtoolsPmpApp || {};
  window.EtoolsPmpApp.Mixins = window.EtoolsPmpApp.Mixins || {};
  /**
  * @polymer
  * @mixinFunction
  * @appliesMixin EtoolsPmpApp.Mixins.Date
  */
  EtoolsPmpApp.Mixins.Common = baseClass => class extends EtoolsPmpApp.Mixins.Date(baseClass) {
    /**
     * Prepare and return the string value we have to display on the interface.
     * Ex: partners and agreements lists data values.
     */
    getDisplayValue(value, isDate, separator, skipSpaces) {// TODO - apply single responsability
      if (typeof value === 'string' && value !== '') {
        if (isDate) {
          return this.prettyDate(value);
        } else {
          return value;
        }
      } else if (Array.isArray(value) && value.length > 0) {
        if (!separator) {
          separator = ', ';
        }
        if (skipSpaces) {
          return _.without(value, undefined, '', null).join(separator);
        }
        return value.join(separator);
      } else if (typeof value === 'number') {
        return value;
      }
      return '-';
    }
    /**
     * Prepare date string and return it in a user readable format
    */
    getDateDisplayValue(dateString) {
      let formatedDate = this.prettyDate(dateString);
      return formatedDate ? formatedDate : '-';
    }

    prepareEtoolsFileDataFromUrl(fileUrl) {
      let files = [];
      if (typeof fileUrl === 'string' && fileUrl !== '') {
        let fileName = this.getFileNameFromURL(fileUrl);
        files = [{
          id: null,
          file_name: fileName,
          path: fileUrl
        }];
      }
      return files;
    }

    getFileNameFromURL(url) {
      if (!url) {
        return '';
      }
      return _.head(url.split('?')).split('/').pop();
    }

    /**
     * TODO: move this method in another mixin
     * Reset field validation
     */
    fieldValidationReset(selector, useValidate) {
      if (!useValidate) {
        useValidate = false;
      }
      let field = this.shadowRoot.querySelector(selector);
      if (field) {
        if (useValidate) {
          field.validate();
        } else {
          field.set('invalid', false);
        }
      }
      return field;
    }
  };

</script>
