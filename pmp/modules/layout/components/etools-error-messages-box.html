<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../bower_components/etools-content-panel/etools-content-panel.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../styles/buttons-styles.html">

<dom-module id="etools-error-messages-box">
  <template>
    <style include="buttons-styles">
      [hidden] {
        display: none !important;
      }

      :host {
        @apply --layout-horizontal;
        @apply --layout-flex;
        @apply --etools-error-messages-box;
      }

      :host([hidden]) {
        display: none;
      }

      etools-content-panel {
        width: 100%;
      }

      .errors-box {
        margin-bottom: 25px;
      }

      .errors-box {
        /* TODO: replace colors with app-theme variables */
        --ecp-header-bg: var(--error-box-heading-color);
        --ecp-content: {
          color: var(--error-box-text-color);
          background-color: var(--error-box-bg-color);
          border-color: var(--error-box-border-color);
        };
      }

      ul {
        padding: 0 0 0 20px;
        margin: 0;
      }

      .errors-box-actions {
        margin-top: 20px;
        @apply --layout-horizontal;
        @apply --layout-end-justified;
      }

      paper-button {
        margin: 0;
      }

      .cancel-li-display {
        display: block;
      }
    </style>

    <etools-content-panel class="errors-box" panel-title="[[title]]">
      <ul>
        <template is="dom-repeat" items=[[errors]]>
          <li hidden$="[[_startsWithEmptySpace(item)]]">[[item]]</li>
          <li hidden$="[[!_startsWithEmptySpace(item)]]" class="cancel-li-display">[[item]]</li>
        </template>
      </ul>

      <div class="errors-box-actions">
        <paper-button class="primary-btn danger-btn"
                      on-tap="_resetErrors">
          Ok
        </paper-button>
      </div>
    </etools-content-panel>

  </template>

  <script>
    'use strict';

    /**
     * @polymer
     * @customElement
     */
    class EtoolsErrorMessagesBox extends Polymer.Element {

      static get is() {
        return 'etools-error-messages-box';
      }

      static get properties() {
        return {
          title: String,
          errors: {
            type: Array,
            value: [],
            notify: true
          },
          hidden: {
            type: Boolean,
            computed: '_errorsLengthChanged(errors)',
            reflectToAttribute: true
          }
        };
      }

      _startsWithEmptySpace(val) {
        return val.startsWith(' ');
      }

      _errorsLengthChanged(errors) {
        if (!errors || (errors && !errors.length)) {
          return true;
        }
        return false;
      }

      _resetErrors() {
        this.set('errors', []);
      }

    }

    window.customElements.define(EtoolsErrorMessagesBox.is, EtoolsErrorMessagesBox);
  </script>
</dom-module>
