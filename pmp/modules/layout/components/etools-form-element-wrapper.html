<link rel="import" href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../../bower_components/paper-input/paper-input-container.html">

<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../../styles/required-field-styles.html">

<dom-module id="etools-form-element-wrapper">
  <template>
    <style include="shared-styles required-field-starred-styles">
      :host {
        width: 100%;
        max-width: var(--etools-form-element-wrapper-max-width, none);
        --paper-input-container-underline: {
          display: none;
        };
        --paper-input-container-underline-focus: {
          display: none;
        };
        --paper-input-container-underline-disabled: {
          display: none;
        };
        --paper-input-prefix: {
          margin-right: 5px;
          margin-top: -2px;
          color: var(--dark-secondary-text-color);
        }
      }

      :host(.right-align) paper-input-container {
        text-align: right;
      }

      .paper-input-input {
        @apply --layout-horizontal;
        display: inline-block;
      }

      :host(.ie) .paper-input-input {
        display: inline-block;
      }

      :host(.ie) .input-value {
        line-height: 24px;
      }

      .placeholder {
        color: var(--secondary-text-color, rgba(0, 0, 0, 0.54));
      }

    </style>
    <paper-input-container always-float-label="[[alwaysFloatLabel]]"
                           no-label-float="[[noLabelFloat]]"
                           required$="[[required]]">
      <label hidden$=[[!label]] slot="label">[[label]]</label>
      <slot name="prefix" slot="prefix"></slot>
      <div slot="input" class="paper-input-input">
        <span class$="input-value [[_getPlaceholderClass(value)]]">
          [[_getDisplayValue(value)]]
        </span>
        <slot></slot>
      </div>
    </paper-input-container>

  </template>

  <script>
    'use strict';

    /**
     * @polymer
     * @customElement
     */
    class EtoolsFormElementWrapper extends Polymer.Element {

      static get is() {
        return 'etools-form-element-wrapper';
      }

      static get properties() {
        return {
          label: String,
          value: {
            type: String,
            value: ''
          },
          alwaysFloatLabel: {
            type: Boolean,
            value: true
          },
          noLabelFloat: Boolean,
          required: {
            type: Boolean,
            reflectToAttribute: true,
            observer: '_requiredChanged'
          },
          noPlaceholder: Boolean
        };
      }

      connectedCallback() {
        super.connectedCallback();
        const appShell = document.querySelector('app-shell');
        if (appShell && appShell.classList.contains('ie')) {
          this.classList.add('ie');
        }
      }

      _requiredChanged(req) {
        if (typeof req === 'undefined') {
          return;
        }
        this.updateStyles();
      }

      _getPlaceholderClass(value) {
        let cssclass = ((typeof value === 'string' && value.trim() !== '')
            ? ''
            : (this.noPlaceholder ? '' : 'placeholder'));
        return cssclass + ' etools-form-element-wrapper';
      }

      _getDisplayValue(value) {
        return (typeof value === 'string' && value.trim() !== '')
            ? value.trim()
            : (this.noPlaceholder ? '' : 'â€”');
      }

    }

    window.customElements.define(EtoolsFormElementWrapper.is, EtoolsFormElementWrapper);
  </script>
</dom-module>
