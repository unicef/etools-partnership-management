<link rel="import" href="../../environment-flags/environment-flags-mixin.html">
<script>
  window.EtoolsPmpApp = window.EtoolsPmpApp || {};
  window.EtoolsPmpApp.Mixins = window.EtoolsPmpApp.Mixins || {};
  
  /**
   * Interventions details tabs functionality
   * @polymer
   * @mixinFunction
   * @appliedMixin EtoolsPmpApp.Mixins.EnvironmentFlags
   */
  EtoolsPmpApp.Mixins.InterventionPageTabs = Polymer.dedupingMixin(
      (superClass) => class extends EtoolsPmpApp.Mixins.EnvironmentFlags(superClass) {
        static get properties() {
          return {
            /**
             * Hidden tabs rules:
             *  - overview - on new intervention page
             *  - reports & progress - if prp sections are disabled and on new intervention page
             */
            interventionTabs: {
              type: Array,
              value: [
                {
                  tab: 'overview',
                  tabLabel: 'Overview',
                  hidden: false
                },
                {
                  tab: 'details',
                  tabLabel: 'Details',
                  hidden: false
                },
                {
                  tab: 'review-and-sign',
                  tabLabel: 'Review & Sign',
                  hidden: false
                },
                {
                  tab: 'attachments',
                  tabLabel: 'Attachments',
                  hidden: false
                },
                {
                  tab: 'reports',
                  tabLabel: 'Reports',
                  hidden: false
                },
                {
                  tab: 'progress',
                  tabLabel: 'Progress',
                  hidden: false
                }
              ]
            }
          };
        }

        static get observers() {
          return ['_computeInterventionTabs(newInterventionActive, environmentFlags)'];
        }

        _computeInterventionTabs(newInterventionActive, environmentFlags) {
          if (newInterventionActive === undefined && environmentFlags === undefined) {
            return;
          }
          let showPrpTabs = this.showPrpReports();
          this.interventionTabs.forEach((t, index) => {
            if (t.tab === 'overview') {
              this._updateTabProperty(index, 'hidden', newInterventionActive);
            }
            if (['reports', 'progress'].indexOf(t.tab) > -1) {
              this._updateTabProperty(index, 'hidden', !showPrpTabs || newInterventionActive);
            }
          });
        }

        _updateTabProperty(tabIndex, property, value) {
          this.set(['interventionTabs', tabIndex, property], value);
        }

      });
  
  
  
  /** @polymerBehavior EtoolsPmpApp.Behaviors.InterventionPageTabsImpl */
  EtoolsPmpApp.Behaviors.InterventionPageTabsImpl = {
    properties: {


    },

    observers: ['_computeInterventionTabs(newInterventionActive, environmentFlags)'],



  };

  /** @polymerBehavior EtoolsPmpApp.Behaviors.InterventionPageTabs */
  EtoolsPmpApp.Behaviors.InterventionPageTabs = [
    EtoolsPmpApp.Behaviors.EnvironmentFlags,
    EtoolsPmpApp.Behaviors.InterventionPageTabsImpl
  ];
</script>
