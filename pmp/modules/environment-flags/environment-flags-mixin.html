<link rel="import" href="../redux/etools-data-redux-store.html">
<script>
  window.EtoolsPmpApp = window.EtoolsPmpApp || {};
  window.EtoolsPmpApp.Mixins = EtoolsPmpApp.Mixins || {};

  /**
   * Environment flags functionality; used to show/hide specific app sections.
   * @polymer
   * @mixinFunction
   * @appliesMixin EtoolsPmpApp.Mixins.EtoolsDataReduxStore
   */
  EtoolsPmpApp.Mixins.EnvironmentFlags = Polymer.dedupingMixin(
      (superClass) => class extends EtoolsPmpApp.Mixins.EtoolsDataReduxStore(superClass) {

        static get properties() {
          return {
            environmentFlags: {
              type: Object,
              statePath: 'envFlags'
            }
          };
        }

        envFlagsLoaded() {
          return typeof this.environmentFlags !== 'undefined';
        }

        showPrpReports() {
          return this.environmentFlags && !this.environmentFlags.prp_mode_off;
        }

        prpServerIsOn() {
          return this.environmentFlags && this.environmentFlags.prp_server_on;
        }

        _checkFlagsReady() {
          return new Promise((resolve, reject) => {
            if (this.envFlagsLoaded()) {
              resolve(true);
            } else {
              // flags not loaded yet, wait a bit and check again
              window.setTimeout(() => {
                resolve(this.envFlagsLoaded());
              }, 200);
            }
          });
        }

        _waitForEnvFlagsToLoad(page) {
          return this._checkFlagsReady().then((flagsLoaded) => {
            return flagsLoaded || this._checkFlagsReady();
          }).then((flagsLoaded) => {
            return flagsLoaded || this._checkFlagsReady();
          });
        }

      });

</script>
