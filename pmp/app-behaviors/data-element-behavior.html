<link rel="import" href="../app-config/app-dexie-db-config.html"/>
<link rel="import" href="../app-config/app-endpoints-behavior.html"/>
<script>
  window.EtoolsPmpApp = window.EtoolsPmpApp || {};
  window.EtoolsPmpApp.Behaviors = window.EtoolsPmpApp.Behaviors || {};
  /** @polymerBehavior EtoolsPmpApp.Behaviors.DataElementImpl */
  EtoolsPmpApp.Behaviors.DataElementImpl = {

    properties: {
      endpoint: {
        type: Object
      },
      data: {
        type: Array,
        readOnly: true,
        notify: true
      },

      db: {
        type: Object,
        value: function() {
          return EtoolsPmpApp.DexieDb; // TODO: check if this is really needed
        }
      },

      fireDataLoaded: {
        type: Boolean,
        value: false
      }

    },

    ready: function() {
      this._elementReady();
    },

    _elementReady: function() {
      if (!this.endpointName) {
        console.warn('Please specify an endpointName property');
      } else {
        this.endpoint = this.getEndpoint(this.endpointName);
      }
    },

    _handleResponse: function(res) {
      this._setData(res.detail);
      if (this.fireDataLoaded) {
        if (!this.dataLoadedEventName) {
          console.warn('Please specify data loaded event name(dataLoadedEventName property)');
        } else {
          this.fire(this.dataLoadedEventName);
        }
      }
    },

    reloadData: function() {
      this.$.ajax.set('url', null);
      this.$.ajax.set('url', this.endpoint.url);
    },

  };

  /** @polymerBehavior EtoolsPmpApp.Behaviors.DataElement */
  EtoolsPmpApp.Behaviors.DataElement = [
    EtoolsPmpApp.Behaviors.Endpoints,
    EtoolsPmpApp.Behaviors.DataElementImpl
  ];

</script>
