<link rel="import" href="../app-config/app-endpoints-behavior.html">
<link rel="import" href="../app-behaviors/ajax-server-errors-behavior.html">
<link rel="import" href="../app-elements/static-common-data/redux-behaviors/common-static-data-redux-behavior.html">

<link rel="import" href="../../bower_components/etools-ajax/etools-ajax-request-behavior.html">
<link rel="import" href="../../bower_components/etools-behaviors/etools-logs-behavior.html">

<script>
  window.EtoolsPmpApp = window.EtoolsPmpApp || {};
  window.EtoolsPmpApp.Behaviors = window.EtoolsPmpApp.Behaviors || {};
  /** @polymerBehavior EtoolsPmpApp.Behaviors.ItemDataImpl */
  EtoolsPmpApp.Behaviors.ItemDataImpl = {
    properties: {
      options: {
        type: Object,
          value: {
            endpoint: null,
            csrf: true
          },
      },
    },
    _prepareAndFireRequest: function(method, data, url, multipart) {
      this.set('options.prepareMultipartData', multipart);
      this.set('options.multiPart', multipart);
      this.set('options.method', method || 'GET');
      this.set('options.body', data || {});
      this.set('options.url', url || this.options.endpoint.url);
      let self = this;

      if (!this.options.url) {
        return;
      }

      this.sendRequest(this.options)
        .then(function(resp) {
          self._handleSuccResponse(resp);
        }).catch(function(error) {
          console.log(error);
          self._handleErrorResponse(error);
        });
    },
    // Some children might overwrite this
    _handleErrorResponse: function(response) {
      this.handleErrorResponse(response);
    }
  };

  /** @polymerBehavior EtoolsPmpApp.Behaviors.ItemData */
  EtoolsPmpApp.Behaviors.ItemData = [
    EtoolsAjaxRequestBehavior,
    EtoolsPmpApp.Behaviors.Endpoints,
    EtoolsLogsBehavior,
    EtoolsPmpApp.Behaviors.AjaxServerErrors,
    EtoolsPmpApp.Behaviors.EtoolsDataReduxStore,
    EtoolsPmpApp.Behaviors.ItemDataImpl
  ];

</script>
