<link rel="import" href="../../bower_components/etools-behaviors/etools-logs-behavior.html">
<script>
  (function() {
    'use strict';

    window.EtoolsPmpApp = window.EtoolsPmpApp || {};
    window.EtoolsPmpApp.Behaviors = window.EtoolsPmpApp.Behaviors || {};
    /** @polymerBehavior EtoolsPmpApp.Behaviors.UtilsImpl */
    EtoolsPmpApp.Behaviors.UtilsImpl = {
      _equals: function(a, b) {
        return a === b;
      },

      _toNumber: function(val) {
        return Number(val);
      },

      _formatNumber: function(val, placeholder, decimals, thousandsPoint, decimalsPoint) {
        placeholder = placeholder ? placeholder : '-';

        let nr = Number(val);
        if (Number.isNaN(nr)) {
          return placeholder;
        }

        decimals = !Number.isNaN(decimals) ? Number(decimals) : 2;
        nr = nr.toFixed(decimals);

        decimalsPoint = decimalsPoint ? decimalsPoint : '.';
        thousandsPoint = thousandsPoint ? thousandsPoint : '';

        if (decimalsPoint && thousandsPoint && decimalsPoint === thousandsPoint) {
          this.logWarn('thousandsPoint and decimalsPoint should be different', 'utils-behavior');
          return nr;
        }
        let nrParts = nr.split('.');
        if (thousandsPoint) {
          let thousandsRegex = new RegExp('(\\d)(?=(\\d{3})+(?!\\d))', 'g');
          nrParts[0] = nrParts[0].replace(thousandsRegex, '$1' + thousandsPoint);
        }
        return nrParts.join(decimalsPoint);
      },

      _capitalizeFirstLetter: function(text) {
        if (text) {
          return text[0].toUpperCase() + text.substring(1);
        }
      },

      _deferred: function() {
        let defer = {};

        defer.promise = new Promise(function(resolve, reject) {
          defer.resolve = resolve;
          defer.reject = reject;
        });

        return defer;
      },

      _toPercentage: function(value) {
        return value == null /* undefinded & null */ ? // jshint ignore:line
            value : Math.floor(value * 100) + '%';
      },

      _fieldsAreValid: function() {
        let valid = true;
        let fields = [].slice.call(
            Polymer.dom(this.root).querySelectorAll('.validate')
        );
        // NOTE: NodeList.forEach is not supported by older browsers(min IE11),
        // using Array.prototype.forEach.call instead
        Array.prototype.forEach.call(fields, function(field) {
          if (!field.validate()) {
            valid = false;
          }
        });

        return valid;
      },

      _ternary: function(value, expected, value1, value2) {
        return (value === expected) ? value1 : value2;
      }
    };

    /** @polymerBehavior EtoolsPmpApp.Behaviors.Utils */
    EtoolsPmpApp.Behaviors.Utils = [
      EtoolsLogsBehavior,
      EtoolsPmpApp.Behaviors.UtilsImpl
    ];
  }());
</script>

