<link rel="import" href="date-behavior.html">
<link rel="import" href="../../scripts/lodash/lodash.html">
<script>
  window.EtoolsPmpApp = window.EtoolsPmpApp || {};
  window.EtoolsPmpApp.Behaviors = window.EtoolsPmpApp.Behaviors || {};
  /** @polymerBehavior EtoolsPmpApp.Behaviors.CommonImpl */
  EtoolsPmpApp.Behaviors.CommonImpl = {
    /**
     * Prepare and return the string value we have to display on the interface.
     * Ex: partners and agreements lists data values.
     */
    getDisplayValue: function(value, isDate, separator, skipSpaces) {//TODO - apply single responsability
      if (typeof value === 'string' && value !== '') {
        if (isDate) {
          return this.prettyDate(value);
        } else {
          return value;
        }
      } else if (Array.isArray(value) && value.length > 0) {
        if (!separator) {
          separator = ', ';
        }
        if (skipSpaces) {
          return _.without(value, undefined, '', null).join(separator);
        }
        return value.join(separator);
      } else if (typeof value === 'number') {
        return value;
      }
      return '-';
    },
    /**
     * Prepare date string and return it in a user readable format
    */
    getDateDisplayValue: function(dateString) {
      return this.getDisplayValue(dateString, true);
    },

    prepareEtoolsFileDataFromUrl: function(fileUrl) {
      let files = [];
      if (typeof fileUrl === 'string' && fileUrl !== '') {
        let fileName = this.getFileNameFromURL(fileUrl);
        files = [{
          id: null,
          file_name: fileName,
          path: fileUrl
        }];
      }
      return files;
    },

    getFileNameFromURL: function(url) {
      return _.head(url.split('?')).split('/').pop();
    },

    /**
     * TODO: move this method in another behavior
     * Reset field validation
     */
    fieldValidationReset: function(selector, useValidate) {
      if (!useValidate) {
        useValidate = false;
      }
      let field = this.$$(selector);
      if (field) {
        if (useValidate) {
          field.validate();
        } else {
          field.set('invalid', false);
        }
      }
      return field;
    },

    conditionsAreTrue: function() {
      for (let key = 0; key < arguments.length; key++) {
        if (!arguments[key]) {
          return false;
        }
      }

      return true;
    }

  };

  /** @polymerBehavior EtoolsPmpApp.Behaviors.Common */
  EtoolsPmpApp.Behaviors.Common = [
    EtoolsPmpApp.Behaviors.Date,
    EtoolsPmpApp.Behaviors.CommonImpl
  ];
</script>
