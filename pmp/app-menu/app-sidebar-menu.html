<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="styles/nav-menu-styles.html">

<dom-module id="app-sidebar-menu">

  <template>

    <style include="nav-menu-styles"></style>

    <div class="menu-header">
      <span hidden$="[[smallMenu]]">
        Partnership <br>
        Management
      </span>

      <iron-icon id="menu-header-top-icon"
                 icon="supervisor-account"
                 hidden$="[[!smallMenu]]"
                 on-tap="_toggleSmallMenu"></iron-icon>
      <paper-tooltip for="menu-header-top-icon" position="right">
        Partnership Management
      </paper-tooltip>

      <!-- TODO: _getMenuSizeChangeBtnIcon (replace with chevron-left) has to be deleted
      in case expand btn is #menu-header-top-icon -->
      <paper-icon-button icon="[[_getMenuSizeChangeBtnIcon(smallMenu)]]"
                         on-tap="_toggleSmallMenu" hidden$="[[smallMenu]]"></paper-icon-button>
    </div>

    <div class="nav-menu">
      <iron-selector selected="[[page]]"
                     attr-for-selected="menu-name"
                     selectable="a"
                     role="navigation">

        <a class="nav-menu-item" menu-name="partners" href$="[[baseUrl]]partners/list" on-tap="_firePageChangeLoading">
          <iron-icon id="partners-icon" icon="social:people"></iron-icon>
          <paper-tooltip for="partners-icon" position="right" hidden$="[[!smallMenu]]">
            Partners
          </paper-tooltip>
          <div class="name" hidden$="[[smallMenu]]">Partners</div>
        </a>

        <a class="nav-menu-item" menu-name="agreements" href$="[[baseUrl]]agreements/list" on-tap="_firePageChangeLoading">
          <iron-icon id="agreements-icon" icon="av:playlist-add-check"></iron-icon>
          <paper-tooltip for="agreements-icon" position="right" hidden$="[[!smallMenu]]">
            Agreements
          </paper-tooltip>
          <div class="name" hidden$="[[smallMenu]]">Agreements</div>
        </a>

        <a class="nav-menu-item" menu-name="interventions" href$="[[baseUrl]]interventions/list" on-tap="_firePageChangeLoading">
          <iron-icon id="pd-ssfa-icon" icon="verified-user"></iron-icon>
          <paper-tooltip for="pd-ssfa-icon" position="right" hidden$="[[!smallMenu]]">
            PD/SSFA
          </paper-tooltip>
          <div class="name" hidden$="[[smallMenu]]">PD/SSFA</div>
        </a>

        <a class="nav-menu-item" menu-name="government-partners" href$="[[baseUrl]]government-partners/list" on-tap="_firePageChangeLoading">
          <iron-icon id="gov-icon" icon="account-balance"></iron-icon>
          <paper-tooltip for="gov-icon" position="right" hidden$="[[!smallMenu]]">
            Government
          </paper-tooltip>
          <div class="name" hidden$="[[smallMenu]]">Government</div>
        </a>

      </iron-selector>

      <div class="secondary-header">
        <span hidden$="[[smallMenu]]">eTools Community Channels</span>
      </div>

      <a class="nav-menu-item lighter-item" href="https://etools.uservoice.com">
        <iron-icon id="knoledge-icon" icon="maps:local-library"></iron-icon>
        <paper-tooltip for="knoledge-icon" position="right" hidden$="[[!smallMenu]]">
          Knowledge base
        </paper-tooltip>
        <div class="name" hidden$="[[smallMenu]]">Knowledge base</div>
      </a>

      <a class="nav-menu-item lighter-item" href="https://www.yammer.com/unicef.org/#/threads/inGroup?type=in_group&feedId=5782560">
        <iron-icon id="discussion-icon" icon="icons:question-answer"></iron-icon>
        <paper-tooltip for="discussion-icon" position="right" hidden$="[[!smallMenu]]">
          Discussion
        </paper-tooltip>
        <div class="name" hidden$="[[smallMenu]]">Discussion</div>
      </a>

      <a class="nav-menu-item lighter-item last-one" href="http://etools.unicefresults.org">
        <iron-icon id="information-icon" icon="icons:info"></iron-icon>
        <paper-tooltip for="information-icon" position="right" hidden$="[[!smallMenu]]">
          Information
        </paper-tooltip>
        <div class="name" hidden$="[[smallMenu]]">Information</div>
      </a>

    </div>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({

        is: 'app-sidebar-menu',

        properties: {
          page: String,
          baseUrl: String,
          smallMenu: {
            type: Boolean,
            value: false,
            reflectToAttribute: true,
            observer: '_menuSizeChange'
          }
        },

        _menuSizeChange: function(newVal, oldVal) {
          if (newVal !== oldVal) {
            this.async(function() {
              this.fire('resize-main-layout');
            });
          }
        },

        _firePageChangeLoading: function(e) {
          let menuOptionEl = e.currentTarget;
          let partnersPages = ['partners', 'government-partners'];
          let newPageName = menuOptionEl.getAttribute('menu-name');

          if (partnersPages.indexOf(newPageName) > -1 && partnersPages.indexOf(this.page) > -1) {
            return;
          }

          if (newPageName !== this.page) {
            e.preventDefault();
            this.fire('global-loading', {
              message: 'Loading ' + newPageName + ' pages elements...',
              active: true,
              resetCounter: true,
              newUrl: menuOptionEl.getAttribute('href').replace(this.baseUrl, '')
            });
          }
        },

        _getMenuSizeChangeBtnIcon: function(smallMenu) {
          return smallMenu ? 'chevron-right' : 'chevron-left';
        },

        _toggleSmallMenu: function(e) {
          e.stopImmediatePropagation();
          this.fire('toggle-small-menu');
        }

      });

    })();
  </script>

</dom-module>
