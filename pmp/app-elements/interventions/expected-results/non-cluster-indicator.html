<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import"
      href="../../../../bower_components/etools-searchable-multiselection-menu/etools-multi-selection-menu.html">

<link rel="import" href="../../../../styles/grid-layout-styles.html">
<link rel="import" href="../../../../styles/shared-styles.html">
<link rel="import" href="../../../../styles/required-field-styles.html">

<link rel="import" href="../../static-common-data/redux-behaviors/common-static-data-redux-behavior.html">

<dom-module id="non-cluster-indicator">
  <template strip-whitespace>
    <style include="grid-layout-styles shared-styles required-field-starred-styles">
      .radioGroup {
        width: 320px;
      }
      paper-input,
      paper-textarea,
      paper-material {
        width: 100%;
      }
      .unknown {
        padding-left: 24px;
        padding-bottom: 16px;
      }
      .no-left-padding {
        padding-left: 0px !important;
      }
      paper-checkbox {
        --paper-checkbox-ink-size: 0px;
      }
      paper-radio-button {
        --paper-radio-button-ink-size: 0px;
      }
    </style>

    <div class="row-h flex-c">
      <div class="layout-vertical">
        <label class="paper-label">Type </label>
        <div class="radioGroup">
          <paper-radio-group selected="{{indicator.indicator.unit}}">
            <paper-radio-button class="no-left-padding" name="number">Quantity (#)</paper-radio-button>
            <paper-radio-button name="percentage">Percent/Ratio</paper-radio-button>
          </paper-radio-group>

        </div>
      </div>
      <div class="layout-vertical">
        <label class="paper-label">Display Type </label>
        <div class="radioGroup">
           <paper-radio-group selected="{{indicator.indicator.display_type}}">
            <paper-radio-button class="no-left-padding" name="percentage">Percentage</paper-radio-button>
            <paper-radio-button name="ratio">Ratio</paper-radio-button>
          </paper-radio-group>
        </div>
      </div>
    </div>
    <div class="row-h flex-c">
      <paper-input id="title" required label="Indicator"
        value="{{indicator.indicator.title}}" placeholder="&#8212;"
        error-message="Please add a title" auto-validate>
      </paper-input>
    </div>

    <!-- Baseline & Target -->
    <div class="row-h flex-c">
      <div class="col col-3">
        <template is="dom-if" if="[[_unitIsNumeric(indicator.unit)]]">
          <paper-input label="Baseline"
                      value="{{indicator.baseline}}"
                      type="number"
                      placeholder="&#8212;" disabled="[[indicator.baselineIsUnknown]]">
          </paper-input>
        </template>
        <template is="dom-if" if="[[!_unitIsNumeric(indicator.unit)]]">
          <paper-input label="Baseline"
                      value="{{indicator.baseline}}"
                      type="number"
                      min="0"
                      max="100"
                      allowed-pattern="[0-9\.]"
                      placeholder="&#8212;" disabled="[[indicator.baselineIsUnknown]]">
          </paper-input>
        </template>
      </div>
      <div class="col col-3">
        <template is="dom-if" if="[[_unitIsNumeric(indicator.unit)]]">
          <paper-input label="Target"
                      value="{{indicator.target}}"
                      type="number"
                      placeholder="&#8212;">
          </paper-input>
        </template>
        <template is="dom-if" if="[[!_unitIsNumeric(indicator.unit)]]">
          <paper-input label="Target"
                      value="{{indicator.target}}"
                      type="number"
                      min="0"
                      max="100"
                      allowed-pattern="[0-9\.]"
                      placeholder="&#8212;">
          </paper-input>
        </template>
      </div>
    </div>
    <div class="unknown">
      <paper-checkbox checked="{{indicator.baselineIsUnknown}}">Unknown </paper-checkbox>
    </div>
    <!-- Baseline & Target -->


    <div class="row-h flex-c">
        <paper-textarea label="Means of Verification"
                        value="{{indicator.means_of_verification}}"
                        placeholder="&#8212;">
        </paper-textarea>
    </div>
    <div class="row-h flex-c">
      <etools-multi-selection-menu id$="locationsDropdw"
                                   label="Locations"
                                   placeholder="&#8212;"
                                   selected-values="{{indicator.locations}}"
                                   options="[[locations]]"
                                   option-label="name"
                                   option-value="id"
                                   error-message="Please select sector locations">
      </etools-multi-selection-menu>
    </div>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'non-cluster-indicator',

        behaviors: [
          EtoolsPmpApp.Behaviors.EtoolsDataReduxStore
        ],

        properties: {
          indicator: {
            type: Object
          },
          locations: {
            type: Array,
            statePath: 'locations'
          },

        },
        observers: [
           '_indicatorDataChange(indicator.*)',
           '_baselineUnknownChanged(indicator.baselineIsUnknown)'
        ],
        _unitIsNumeric: function(unit) {
          return unit === 'numeric';
        },

        _baselineUnknownChanged: function(isUnknown) {
          if (isUnknown) {
            this.set('indicator.baseline', null);
          }
        },

        _indicatorDataChange: function(data) {
          if (data.path === 'indicator.baseline' || data.path === 'indicator.target') {
            if (this.indicator.unit === 'percentage' && data.value !== '') {
              var val = parseInt(data.value, 10);
              if (isNaN(val) || val < 0) {
                val = 0;
              }
              if (val > 100) {
                val = 100;
              }
              this.set(data.path, val);
            }
          }
        },
        validate: function() {
          return this.$.title.validate();
        },
        resetValidations: function() {
          this.$.title.invalid = false;
        }

    });
  })();
  </script>
</dom-module>
