<link rel="import" href="../../../app-behaviors/repeatable-data-sets-behavior.html">
<link rel="import" href="applied-indicator.html">

<dom-module id="applied-indicators">
  <template strip-whitespace>
    <style>
      applied-indicator {
        margin-right: -24px;
      }
    </style>
    <template is="dom-repeat"
    items="[[dataItems]]"
    as="indicator" index-as="indicatorIndex">
    <applied-indicator data-args$="[[indicatorIndex]]"
                  on-edit-indicator="_editIndicator"
                  on-delete-indicator="_openDeleteConfirmation"
                  indicator="[[indicator]]"
                  edit-mode="[[editMode]]"
                  intervention-status="[[interventionStatus]]"></applied-indicator>
</template>
  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'applied-indicators',
        properties: {
          _deleteEpName: {
            type: String,
            value: 'getEditDeleteIndicator',
            readOnly: true,
          },
          resultLinkIndex: Number,
          editMode: Boolean,
          interventionStatus: String,
          cpOutputId: Number
        },
        behaviors: [
          EtoolsPmpApp.Behaviors.RepeatableDataSets
        ],

        _editIndicator: function(event) {
          let indicatorIndex = parseInt(Polymer.dom(event).localTarget.getAttribute('data-args'), 10);
          let llResultIndex = parseInt(this.resultLinkIndex, 10);
          let indicator = JSON.parse(JSON.stringify(this.dataItems[indicatorIndex]));

          let resultMap = {
            cpOutputId: this.cpOutputId,
            llResultIndex: llResultIndex,
            llResultId: indicator.lower_result,
            indicatorData: indicator,
            appliedIndicatorsIndex: indicatorIndex
          };
          this.fire('open-indicator-dialog', resultMap);
        },
      });
    })();
  </script>
</dom-module>
