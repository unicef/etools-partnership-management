<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/etools-dialog/etools-dialog.html">
<link rel="import" href="../../../../bower_components/iron-label/iron-label.html">

<link rel="import" href="../../../app-config/app-dexie-db-config.html">
<link rel="import" href="../../../../styles/shared-styles.html">
<link rel="import" href="../../../../styles/grid-layout-styles.html">
<link rel="import" href="../../common-elements/etools-date-input.html">

<dom-module id="reporting-requirements-dialog">
  <template>
    <style include="shared-styles grid-layout-styles">
      [hidden] {
        display: none !important;
      }
      #content-box {
        margin-bottom: 20px;
      }
    </style>
    <etools-dialog
        id="reportingRequirementsDialog"
        size="md"
        no-padding
        keep-dialog-open
        ok-btn-text="Save"
        cancel-btn-text="Cancel"
        dialog-title="Add/Edit Reporting Requirements"
        hidden$="[[_isDatePickerOpen(startDateOpen, endDateOpen, dueDateOpen)]]"
        on-confirm-btn-clicked="_saveChanges">
      <div id="content-box">
        <div class="row-h">
          <div class="col col-4">
            <etools-date-input id="reportingPeriodStartDate"
                               label="Reporting Period Start Date"
                               value="{{requirement.start_date}}"
                               open="{{startDateOpen}}"
                               required
                               no-init show-clear-btn>
            </etools-date-input>
          </div>
          <div class="col col-4">
            <etools-date-input id="reportingPeriodEndDate"
                               label="Reporting Period End Date"
                               value="{{requirement.end_date}}"
                               open="{{endDateOpen}}"
                               required
                               no-init show-clear-btn>
            </etools-date-input>
          </div>
          <div class="col col-4">
            <etools-date-input id="reportingPeriodDueDate"
                               label="Reporting Period Due Date"
                               value="{{requirement.due_date}}"
                               open="{{dueDateOpen}}"
                               required
                               no-init show-clear-btn>
            </etools-date-input>
          </div>
        </div>
      </div>
    </etools-dialog>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'reporting-requirements-dialog',
        behaviors: [
        ],
        properties: {
          requirement: {
            type: Object,
          },
          startDateOpen: {
            type: Boolean,
            value: false
          },
          endDateOpen: {
            type: Boolean,
            value: false
          },
          dueDateOpen: {
            type: Boolean,
            value: false
          },
          fieldsToValidate: {
            type: Array,
            value: [
              '#reportingPeriodStartDate',
              '#reportingPeriodEndDate',
              '#reportingPeriodDueDate'
            ]
          }
        },

        open: function() {
          if (!this.$.reportingRequirementsDialog.opened) {
            this.$.reportingRequirementsDialog.opened = true;
            this._resetValidations();
          }
        },

        _saveChanges: function(event) {
          let valid = true;
          let self = this;

          this.fieldsToValidate.forEach(function(selector) {
            valid = self.$$(selector).validate() && valid;
          });

          if (!valid) {
            return false;
          }

          this.fire('save-requirement', this.requirement);
          this.$.reportingRequirementsDialog.set('opened', false);
          return true;
        },

        _resetValidations: function() {
          let self = this;
          this.fieldsToValidate.forEach(function(selector) {
            self.$$(selector).resetInvalidState();
          });
        },

        _isDatePickerOpen: function(startDateOpen, endDateOpen, dueDateOpen) {
          return startDateOpen || endDateOpen || dueDateOpen;
        }
      });
    })();
  </script>
</dom-module>

