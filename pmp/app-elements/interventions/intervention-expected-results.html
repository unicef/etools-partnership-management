<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/etools-searchable-multiselection-menu/etools-searchable-multiselection-menu.html">

<link rel="import" href="../../../styles/grid-layout-styles.html">
<link rel="import" href="../../../styles/shared-styles.html">
<link rel="import" href="../../../styles/repeatable-data-sets-styles.html">
<link rel="import" href="../../../styles/file-styles.html">
<link rel="import" href="../../../styles/buttons-styles.html">

<link rel="import" href="../../app-elements/static-common-data/redux-behaviors/common-static-data-redux-behavior.html">
<link rel="import" href="../../app-behaviors/repeatable-data-sets-behavior.html">
<link rel="import" href="../../app-behaviors/date-behavior.html">

<link rel="import" href="intervention-form/ram-indicator-selector.html">

<dom-module id="intervention-expected-results">
  <template>
    <style include="grid-layout-styles shared-styles repeatable-data-sets-styles file-styles buttons-styles">
      [hidden] {
        display: none !important;
      }

      :host {
        display: block;
        width: 100%;
        padding: 7px 0;

        --paper-fab-keyboard-focus-background: #8dc63f; /* TODO: replace with app-theme var */
        --paper-fab: {
          @apply(--paper-fab-btn-green);
        };
      }

      .item-container {
        padding: 8px 15px;
      }

      .item-actions-container {
        position: relative;
        padding-right: 10px;
        border-right: 2px solid #00aeef; /* TODO: replace with app-theme var */;
        margin-top: 25px;
      }

      .item-container .item-content {
        margin-left: 0;
        border-left: none;
        padding-bottom: 25px;
      }

    </style>

    <div hidden$="[[_emptyList(dataItems.length)]]">
      <template is="dom-repeat" items="{{dataItems}}">
        <div class="row-h item-container">
          <div class="row-h item-actions-container">
            <div class="row-v actions">
              <paper-icon-button class="action delete"
                                 on-tap="_openDeleteConfirmation"
                                 data-args$="[[index]]"
                                 icon="cancel"></paper-icon-button>
            </div>
          </div>
          <div class="row-v flex-c item-content">

              <div class="row-h">
                <ram-indicator-selector cp-output-id="{{item.cp_output}}"
                                        selected-cp-indicators-ids="{{item.ram_indicators}}">
                </ram-indicator-selector>
              </div>

              <div class="row-h">
              </div>

          </div>
        </div>
      </template>
    </div>

    <div class="row-h" hidden$="[[!_emptyList(dataItems.length)]]">
      <p>There are no results added.</p>
    </div>

    <div id="bottom-actions" class="row-h" hidden$="[[!editMode]]">
      <paper-fab icon="add"
                 on-tap="_addNewResult"
                 title="Add"></paper-fab>
    </div>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'intervention-expected-results',

        behaviors: [
          pmpBehaviors.EtoolsStaticCommonDataReduxBehavior,
          pmpBehaviors.RepeatableDataSetsBehavior,
          pmpBehaviors.DateBehavior
        ],

        properties: {
          interventionId: {
            type: Number,
            observer: 'interventionIdChanged'
          },
          required: {
            type: Boolean,
            value: false
          },
          editMode: {
            type: Boolean,
            value: false
          }
        },

        observers: [
          '_dataItemsChanged(dataItems)'
        ],

        ready: function() {
          this.dataSetModel = {
            id: null,
            intervention: null,
            cp_output: null,
            ram_indicators: [],
            ll_results: []
          };
        },

        interventionIdChanged: function(interventionId) {
          if (interventionId > 0) {
            this.set('dataModel.intervention', interventionId);
          } else {
            this.set('dataModel.intervention', null);
          }
        },

        _dataItemsChanged: function(dataItems) {
          if (!Array.isArray(dataItems)) {
            this.set('dataItems', []);
          }
        },

        /**
         * Validate last added amendment and if is not empty add a new one
         */
        _addNewResult: function() {
          this._addElement();
        },


      });
    })();
  </script>
</dom-module>
