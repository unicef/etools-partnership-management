<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/etools-currency-amount-input/etools-currency-behavior.html">

<link rel="import" href="../../app-behaviors/date-behavior.html">
<link rel="import" href="behaviors/fr-numbers-validations-behavior.html">

<link rel="import" href="../../../styles/table-styles.html">

<dom-module id="fund-reservations-display">
  <template strip-whitespace>
    <style include="table-styles">
      .padding {
        padding: 16px 20px;
      }
      .totals-row {
        font-weight: bold;
      }
      .table > tbody > tr > td {
        padding: 16px 15px;
        line-height: 1.4;
        vertical-align: top;
        border-top: 1px solid var(--dark-divider-color);
      }
      .frs-warning {
        padding: 24px;
        color: var(--error-color);
        border-top: 1px solid var(--dark-divider-color);
      }
    </style>
    <table class="table r-align first-c-always-left" hidden$="[[_noFrs(frsDetails)]]">
        <thead>
          <tr>
            <th>FR#</th>
            <th>FR Posting Date</th>
            <th>FR Amount $</th>
            <th>Actual $</th>
            <th>Outstanding $</th>
          </tr>
        </thead>
        <tbody>
          <template id="repeater" is="dom-repeat" items="[[frsDetails.frs]]" as="fr">
          <tr>
            <td>[[fr.fr_number]]</td>
            <td>[[prettyDate(fr.start_date)]] </td>
            <td>[[displayCurrencyAmount(fr.total_amt, '0.00')]] </td>
            <td>[[displayCurrencyAmount(fr.actual_amt, '0.00')]]</td>
            <td>[[displayCurrencyAmount(fr.outstanding_amt, '0.00')]]</td>
          </tr>
          </template>
          <tr class="darkRow totals-row">
            <td></td>
            <td>TOTAL</td>
            <td>[[displayCurrencyAmount(frsDetails.total_frs_amt, '0.00')]] </td>
            <td>[[displayCurrencyAmount(frsDetails.total_actual_amt, '0.00')]]</td>
            <td>[[displayCurrencyAmount(frsDetails.total_outstanding_amt, '0.00')]]</td>
          </tr>
        </tbody>
    </table>
    <div class="frs-warning" hidden$="[[_hideFrsWarning(intervention, frsDetails)]]">
        [[_frsWarning]]
    </div>
    <div class="padding" hidden$="[[!_noFrs(frsDetails)]]">
      <p>There are no fund reservations added for this intervention.</p>
    </div>
  </template>
  <script>
    (function() {
      'use strict';
       Polymer({
        is: 'fund-reservations-display',

        behaviors: [
          etoolsBehaviors.EtoolsCurrencyBehavior,
          pmpBehaviors.DateBehavior,
          pmpBehaviors.FrNumbersValidationsBehavior
        ],
        properties: {
          intervention: {
            type: Object
          },
          frsDetails: {
            type: Object
          },
          _frsWarning: String
        },
        _noFrs: function() {
          return (!this.frsDetails || !this.frsDetails.frs || !this.frsDetails.frs.length);
        },
        _hideFrsWarning: function() {
          if (this._noFrs()) {
            return true;
          }
          let warn = this.compareFrsTotalAmountWithIntervData(this.frsDetails, this.intervention);
          this.set('_frsWarning', warn);
          return !!!warn;
        }
      });

    })();
  </script>
</dom-module>
