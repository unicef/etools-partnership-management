<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/etools-ajax/etools-ajax-request-behavior.html">
<link rel="import" href="../../../../bower_components/etools-behaviors/etools-logs-behavior.html">

<link rel="import" href="../../../../scripts/lodash/lodash.html">
<link rel="import" href="../../../app-config/app-endpoints-behavior.html">
<link rel="import" href="../../../app-config/app-dexie-db-config.html">

<dom-module id="reporting-requirements-data">

  <script>
    (function() {
      'use strict';
      Polymer({

        is: 'reporting-requirements-data',
        behaviors: [
          EtoolsAjaxRequestBehavior,
          EtoolsPmpApp.Behaviors.Endpoints
        ],
        properties: {
          endpointName: {
            type: String,
            value: 'reportRequirementsList'
          },
          interventionId: {
            type: Number,
            observer: '_interventionIdChanged'
          },
          reportingRequirements: {
            type: Array,
            notify: true
          },
          ajaxMethod: String,
        },


        _interventionIdChanged: function(newId) {
          let self = this;
          if (newId) {
            this.sendRequest({method:'GET', endpoint: this.getEndpoint(this.endpointName, {intervId: this.interventionId})})
              .then(function(resp) {
                self.set('reportingRequirements', response);
              });;
          }
        },

        addRequirement: function(requirement) {
          let endpoint = this.getEndpoint(this.endpointName, {intervId: this.interventionId});
          let self = this;

          requirement.intervention = this.interventionId;

          return this.sendRequest({method: 'POST', endpoint: endpoint, body: requirement})
                   .then(function(response) {
                     self.push('reportingRequirements', response);
                   });
        },


      });
    })();
  </script>

</dom-module>
