<script>
  var interventionNoEditPermissionsModel = {
    id: false,
    status: false,

    // details - Partnership Information
    agreement: false,
    document_type: false,
    number: false,
    title: false,
    offices: false,
    unicef_focal_points: false,
    partner_focal_points: false,

    // details - PD or SSFA Details
    country_programme: false,
    start: false,
    end: false,
    sector_locations: false,

    // details - PD Output or SSFA Expected results
    result_links: false,

    // details - Planned Budget
    planned_budget: false,
    planned_budget_unicef_cash: false, // TODO: this should be also received from backend

    // details - Planned Visits
    planned_visits: false,

    // review & sign - Signatures & Dates
    submission_date: false,
    submission_date_prc: false,
    review_date_prc: false,
    prc_review_document: false,
    partner_authorized_officer_signatory: false,
    signed_by_partner_date: false,
    unicef_signatory: false,
    signed_by_unicef_date: false,
    signed_pd_document: false,

    // review & sign - Amendments
    amendments: false,

    // review & sign - FR Numbers
    frs: false,

    // attachments
    attachments: false,
  };


  window.pmpBehaviors = window.pmpBehaviors || {};
  /** @polymerBehavior pmpBehaviors.InterventionPermissionsBehavior */
  pmpBehaviors.InterventionPermissionsBehavior = {

    properties: {
      _intervNoEditPerm: {
        type: Object,
        value: {
          edit: Object.assign({}, interventionNoEditPermissionsModel),
          required: Object.assign({}, interventionNoEditPermissionsModel)
        }
      }
    },

    _getNewIntervRequiredFields: function() {
      return ['partner', 'agreement', 'document_type', 'title'];
    },

    _getDraftToSignedRequiredFields: function() {
      return ['offices', 'unicef_focal_points', 'partner_focal_points', 'start', 'end', 'sector_locations',
        'partner_authorized_officer_signatory', 'signed_by_partner_date', 'unicef_signatory',
        'signed_by_unicef_date', 'signed_pd_document'];
    },

    _getNoEditPermissionsClone: function() {
      return JSON.parse(JSON.stringify(this._intervNoEditPerm));
    },

    _getNewInterventionPermissions: function() {
      // get a fresh reseted permissions list
      let newIntervPerm = this._getNoEditPermissionsClone();
      let fieldName;
      // set required fields
      let reqFields = this._getNewIntervRequiredFields();
      for(fieldName in newIntervPerm.required) {
        if (reqFields.indexOf(fieldName) > -1) {
          newIntervPerm.required[fieldName] = true;
        }
      }
      let notEditableFieldsForDraft = ['amendments', 'frs'];
      // set editable fields
      for(fieldName in newIntervPerm.edit) {
        if (notEditableFieldsForDraft.indexOf(fieldName) === -1) {
          newIntervPerm.edit[fieldName] = true;
        }
      }
      return newIntervPerm;
    },

    _setPermissions: function(perm) {
      this.set('intervention.permissions', perm);
    },

    cancelEditPermissions: function() {
      this._setPermissions(this._getNoEditPermissionsClone());
    },

    setInterventionPermissions: function(newIntervention, perm) {
      if (newIntervention) {
        this._setPermissions(this._getNewInterventionPermissions());
      } else {
        if (perm) {
          this._setPermissions(perm);
        }
        // TODO: remove this after planned_budget_unicef_cash is received from backend
        this.set('intervention.permissions.edit.planned_budget_unicef_cash',
            this.get('intervention.permissions.edit.planned_budget'));
      }
    },

    getDraftToSignedTransitionPermissions: function(currentPerm) {
      let reqFieldsForSignedStatus = this._getDraftToSignedRequiredFields();
      let perm = JSON.parse(JSON.stringify(currentPerm));
      reqFieldsForSignedStatus.forEach(function(field) {
        perm.required[field] = true;
        perm.edit[field] = true;
      });
      return perm;
    }

  };
</script>
