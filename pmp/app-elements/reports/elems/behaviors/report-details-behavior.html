<link rel="import" href="../../../../../bower_components/etools-behaviors/etools-logs-behavior.html">
<link rel="import" href="../../../../../bower_components/etools-ajax/etools-ajax-request-behavior.html">
<link rel="import" href="../../../../app-config/app-endpoints-behavior.html">
<link rel="import" href="../../../../app-behaviors/ajax-errors-parser-behavior.html">
<link rel="import" href="../../../static-common-data/redux-behaviors/common-static-data-redux-behavior.html">

<script>
  window.EtoolsPmpApp = window.EtoolsPmpApp || {};
  window.EtoolsPmpApp.Behaviors = window.EtoolsPmpApp.Behaviors || {};
  /** @polymerBehavior EtoolsPmpApp.Behaviors.ReportDetailsImpl */
  EtoolsPmpApp.Behaviors.ReportDetailsImpl = {

    properties: {
      report: Object,
      currentUser: {
        type: Object,
        statePath: 'currentUser'
      },
      reportActions: {
        type: Array,
        value: [
          {
            label: 'Accept',
            primary: true,
            event: 'accept-report'
          },
          {
            label: 'Send back to partner',
            event: 'send-back-to-partner'
          },
          {
            label: 'Download',
            event: 'download-report'
          }
        ]
      }
    },

    requestReportDetails: function(id) {
      console.log('T1');
      let loadingSource = 'report-details';
      let logMsgPrefix = 'report-details-behavior';
      if (!this.currentUser) {
        this.logWarn('Logged user data not init in Redux store.', logMsgPrefix);
        return;
      }

      this.fire('global-loading', {
        message: 'Loading report details...',
        active: true,
        loadingSource: loadingSource
      });

      let self = this;

      self.fireRequest('reportDetails', {reportId: id}).then(function(response) {
        self.set('report', response);
        self.fire('global-loading', {active: false, loadingSource: loadingSource});
      }).catch(function(error) {
        let errMsg = 'Reports details data request failed!';
        self.logError(errMsg, logMsgPrefix, error);
        self.parseRequestErrorsAndShowAsToastMsgs(error, self, true);
        self.fire('global-loading', {active: false, loadingSource: loadingSource});
      });
    }
  };

  /** @polymerBehavior EtoolsPmpApp.Behaviors.ReportDetails */
  EtoolsPmpApp.Behaviors.ReportDetails = [
    EtoolsLogsBehavior,
    EtoolsAjaxRequestBehavior,
    EtoolsPmpApp.Behaviors.Endpoints,
    EtoolsPmpApp.Behaviors.AjaxErrorsParser,
    EtoolsPmpApp.Behaviors.EtoolsDataReduxStore,
    EtoolsPmpApp.Behaviors.ReportDetailsImpl
  ];
</script>
