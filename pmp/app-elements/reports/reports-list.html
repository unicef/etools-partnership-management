<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">

<link rel="import" href="../../app-behaviors/app-navigation-helper-behavior.html">
<link rel="import" href="../../app-behaviors/list-filters-behavior.html">
<link rel="import" href="../static-common-data/redux-behaviors/common-static-data-redux-behavior.html">

<link rel="import" href="../../../styles/app-mixins.html">
<link rel="import" href="../../../styles/shared-styles.html">
<link rel="import" href="../../../styles/list-filter-styles.html">

<link rel="import" href="elems/reports-display-list.html">

<dom-module id="reports-list">

  <template strip-whitespace>

    <style include="shared-styles list-filter-styles">
      :host {

      }

    </style>

    <paper-material id="listControls" elevation="1">

      <div class="wrap-controls">

        <paper-input id="query"
                     type="search"
                     autocomplete="off"
                     value="{{q}}"
                     placeholder="Search">
          <iron-icon icon="search" prefix></iron-icon>
        </paper-input>

        <template is="dom-repeat" items="[[selectedFilters]]" as="filter">
          <div class="dropdown-with-clear-btn">
            <paper-icon-button class="clear dark" icon="close"
                               on-tap="clearDropdown"
                               disabled$="[[filter.disabled]]"
                               hidden$="[[filter.disabled]]"></paper-icon-button>
            <paper-dropdown-menu label$="[[filter.filterName]]" noink disabled$="[[filter.disabled]]">
              <paper-menu class="dropdown-content"
                          attr-for-selected="name"
                          on-iron-select="filterValueChanged"
                          on-iron-deselect="filterValueChanged"
                          data-filter-path$="[[filter.path]]"
                          on-iron-activate="_dropdownSelected"
                          selected="[[filter.alreadySelected]]">
                <template is="dom-repeat" items="[[filter.selectionOptions]]" as="filterOption">
                  <paper-item name="[[filterOption]]">[[filterOption]]</paper-item>
                </template>
              </paper-menu>
            </paper-dropdown-menu>
            <paper-icon-button class="remove" icon="cancel"
                               on-tap="removeFilter"
                               data-filter-name$="[[filter.filterName]]"
                               data-reset-path$="[[filter.path]]"
                               disabled$="[[filter.disabled]]"
                               hidden$="[[filter.disabled]]">
            </paper-icon-button>
          </div>
        </template>

      </div>

      <div class="fixed-controls">

        <div class="filter-bar-action-wrapper menu-btn-wrapper">
          <paper-menu-button id="filterMenu">
            <paper-button class="button dropdown-trigger">
              <iron-icon icon="filter-list"></iron-icon>
              add filter
            </paper-button>
            <paper-menu class="dropdown-content">
              <template is="dom-repeat" items="[[availableListFilterOptions]]">
                <paper-item on-tap="selectFilter">[[item.filterName]]</paper-item>
              </template>
            </paper-menu>
          </paper-menu-button>
        </div>
      </div>

    </paper-material>

    <reports-display-list no-collapse></reports-display-list>

  </template>

  <script>
    (function() {
      'use strict';

      let _reportsLastNavigated = null;

      Polymer({

        is: 'reports-list',

        behaviors: [
          EtoolsPmpApp.Behaviors.AppNavigationHelper,
          EtoolsPmpApp.Behaviors.ListFilters,
          EtoolsPmpApp.Behaviors.EtoolsDataReduxStore
        ],

        properties: {
          urlParams: {
            type: Object,
          },

          initComplete: {
            type: Boolean,
            value: true
          },
          csvDownloadUrl: {
            type: String,
            notify: true
          }
        },

        observers: [

        ],

        ready: function() {
          this.setMockFilters();
        },

        attached: function() {
          /**
           * Disable loading message for main list elements load,
           * triggered by parent element on stamp
           */
          this.fire('global-loading', {active: false, loadingSource: 'reports-page'});
        },

        setMockFilters: function() {
          this.set('selectedFilters', [
            {
              filterName: 'Partner',
              type: 'dropdown',
              alreadySelected: null,
              disabled: false
            },
            {
              filterName: 'CP Output',
              type: 'dropdown',
              alreadySelected: null,
              disabled: false
            },
            {
              filterName: 'Report Status',
              type: 'dropdown',
              alreadySelected: null,
              disabled: false
            },
            {
              filterName: 'Section',
              type: 'dropdown',
              alreadySelected: null,
              disabled: false
            },
          ]);
        }

      });
    })();

  </script>

</dom-module>
