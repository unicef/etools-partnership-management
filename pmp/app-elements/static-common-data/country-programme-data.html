<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/etools-ajax/etools-ajax.html">

<link rel="import" href="redux-behaviors/common-static-data-redux-behavior.html">

<dom-module id="country-programme-data">

    <template>
        <etools-ajax id="ajax"
                     endpoint="[[endpoint]]"
                     caching-storage="dexie"
                     on-success="_handleResponse"></etools-ajax>
    </template>

    <script>
        (function() {
            'use strict';

            Polymer({
                is: 'country-programme-data',
                behaviors: [
                    pmpBehaviors.EtoolsStaticCommonDataReduxBehavior,
                    etoolsAppConfig.globals
                ],
                properties: {
                    endpoint: {
                        type: Object
                    }
                },
                actions: {
                    setCountryProgrammeData: function(countryProgrammeData){
                        return {
                            type: 'SET_COUNTRY_PROGRAMME_DROPDOWN',
                            countryProgramme: countryProgrammeData
                        }
                    }
                },

                ready: function() {
                    this.set('endpoint', this.getEndpoint('countryProgramme'));
                },

                _handleResponse: function(response) {
                    var values = _.get(response,'detail')
                    if (!_.isEmpty(values)) {
                        // set offices values
                        this.dispatch('setCountryProgrammeData', this._prepareData(values));
                    }
                },

                /**
                 * Prepare values for dropdowns
                 */

                _prepareData: function(data) {
                    return data.map(function(d) {
                        return {
                            value: parseInt(d.id, 10),
                            label: d.name,
                            from_date: d.from_date,
                            to_date: d.to_date
                        };
                    });
                }

            });
        })();
    </script>
</dom-module>
