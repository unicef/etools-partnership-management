<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/etools-ajax/etools-ajax.html">
<link rel="import" href="../../app-config/etools-app-config.html">

<link rel="import" href="redux-behaviors/common-static-data-redux-behavior.html">

<dom-module id="sections-data">

    <template>
        <etools-ajax id="ajax"
                     endpoint="[[endpoint]]"
                     caching-storage="dexie"
                     on-success="_handleResponse"></etools-ajax>
    </template>

    <script>
        (function() {
            'use strict';

            Polymer({
                is: 'sections-data',
                behaviors: [
                    pmpBehaviors.EtoolsStaticCommonDataReduxBehavior,
                    etoolsAppConfig.globals
                ],
                properties: {
                    endpoint: {
                        type: Object
                    }
                },
                actions: {
                    setSectionsData: function(sectionsData) {
                        return {
                            type: 'SET_SECTIONS',
                            sections: sectionsData
                        };
                    }
                },

                ready: function() {
                    this.set('endpoint', this.getEndpoint('sections'));
                },

                _handleResponse: function(response) {
                    var values = _.get(response, 'detail');
                    if (!_.isEmpty(values)) {
                        // set offices values
                        this.dispatch('setSectionsData', this._prepareData(values));
                    }
                },

                /**
                 * Prepare values for dropdowns
                 */

                _prepareData: function(data) {
                    return data.map(function(d) {
                        return {
                            value: parseInt(d.id, 10),
                            label: d.name
                        };
                    });
                }

            });
        })();
    </script>
</dom-module>
