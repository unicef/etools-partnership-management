<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/etools-ajax/etools-ajax.html">
<link rel="import" href="../../app-config/etools-app-config.html">

<link rel="import" href="redux-behaviors/common-static-data-redux-behavior.html">

<dom-module id="dropdowns-static-data">

  <template>
    <etools-ajax id="ajax"
                 endpoint="[[endpoint]]"
                 caching-storage="dexie"
                 on-success="_handleResponse"></etools-ajax>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({

        is: 'dropdowns-static-data',
        behaviors: [
          pmpBehaviors.EtoolsStaticCommonDataReduxBehavior,
          etoolsAppConfig.globals
        ],
        properties: {

          endpoint: {
            type: Object
          }

        },
        actions: {
          setInterventionDocTypes: function(docTypes) {
            return {
              type: 'SET_INTERVENTION_DOC_TYPES',
              interventionDocTypes: docTypes
            };
          },
          setInterventionStatuses: function(statuses) {
            return {
              type: 'SET_INTERVENTION_STATUSES',
              statuses: statuses
            };
          },
          setCurrencies: function(currenciesData) {
            return {
              type: 'SET_CURRENCIES',
              currencies: currenciesData
            };
          },
          setAgencyChoices: function(agencyChoices) {
            return {
              type: 'SET_AGENCY_CHOICHES',
              agencyChoices: agencyChoices
            };
          },
          setAgreementAmendmentTypes: function(agreementAmmendmentTypes) {
            return {
              type: 'SET_AGREEMENT_AMENDMENT_TYPES',
              agreementAmendmentTypes: agreementAmmendmentTypes
            };
          },
          setCsoTypes: function(csoTypes) {
            return {
              type: 'SET_CSO_TYPES',
              csoTypes: csoTypes
            };
          },
          setPartnerTypes: function(partnerTypes) {
            return {
              type: 'SET_PARTNER_TYPES',
              partnerTypes: partnerTypes
            };
          },
          setAssessmentTypes: function(assessmentTypes) {
            return {
              type: 'SET_ASSESSMENT_TYPES',
              assessmentTypes: assessmentTypes
            };
          },
          setInterventionAmendmentTypes: function(interventionAmendmentTypes) {
            return {
              type: 'SET_INTERVENTION_AMENDMENT_TYPES',
              interventionAmendmentTypes: interventionAmendmentTypes
            };
          },
          setAgreementTypes: function(agreementTypesData) {
            return {
              type: 'SET_AGREEMENT_TYPES',
              agreementTypes: agreementTypesData
            };
          },
          setAgreementStatuses: function(agreementStatusesData) {
            return {
              type: 'SET_AGREEMENT_STATUSES',
              statuses: agreementStatusesData
            };
          }
        },

        ready: function() {
          this.set('endpoint', this.getEndpoint('dropdownsStatic'));
        },

        _handleResponse: function(response) {
          if (response.detail) {
            // set intervention_doc_type values
            var interventionDocType = response.detail.intervention_doc_type;
            if (Array.isArray(interventionDocType) && interventionDocType.length > 0) {
              this.dispatch('setInterventionDocTypes', interventionDocType);
            }
            // set intervention_status values
            var interventionStatus = response.detail.intervention_status;
            if (Array.isArray(interventionStatus) && interventionStatus.length > 0) {
              this.dispatch('setInterventionStatuses', interventionStatus);
            }
            // set currencies data
            if (Array.isArray(response.detail.currencies) && response.detail.currencies.length > 0) {
              this.dispatch('setCurrencies', response.detail.currencies);
            }
            // set agreement types data
            if (Array.isArray(response.detail.agreement_types) && response.detail.agreement_types.length > 0) {
              this.dispatch('setAgreementTypes', response.detail.agreement_types);
            }
            // set agreement statuses data
            if (Array.isArray(response.detail.agreement_status) && response.detail.agreement_status.length > 0) {
              this.dispatch('setAgreementStatuses', response.detail.agreement_status);
            }
            // set agency data
            if (Array.isArray(response.detail.agency_choices) && response.detail.agency_choices.length > 0) {
              this.dispatch('setAgencyChoices', response.detail.agency_choices);
            }
            // set agreement amendment data
            var agreementAmmendmentTypes = response.detail.agreement_amendment_types;
            if (Array.isArray(agreementAmmendmentTypes) && agreementAmmendmentTypes.length > 0) {
              this.dispatch('setAgreementAmendmentTypes', agreementAmmendmentTypes);
            }
            // set cso types data
            if (Array.isArray(response.detail.cso_types) && response.detail.cso_types.length > 0) {
              this.dispatch('setCsoTypes', response.detail.cso_types);
            }
            // set partner types data
            if (Array.isArray(response.detail.partner_types) && response.detail.partner_types.length > 0) {
              this.dispatch('setPartnerTypes', response.detail.partner_types);
            }
            // set assessment types data
            if (Array.isArray(response.detail.assessment_types) && response.detail.assessment_types.length > 0) {
              this.dispatch('setAssessmentTypes', response.detail.assessment_types);
            }
            // set intervention ammendment data
            var interventionAmendmentTypes = response.detail.intervention_amendment_types;
            if (Array.isArray(interventionAmendmentTypes) && interventionAmendmentTypes.length > 0) {
              this.dispatch('setInterventionAmendmentTypes', interventionAmendmentTypes);
            }
          }
        },

        /**
         * Prepare values for dropdowns
         */
        _prepareDropdownStatusesData: function(data) {
          return data.map(function(d, index) {
            return {
              value: (index + 1), // value must be integer for esmm to work
              label: d.label
            };
          });
        }

      });
    })();
  </script>

</dom-module>
