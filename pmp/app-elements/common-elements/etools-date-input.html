<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/etools-datepicker/etools-datepicker-button.html">
<link rel="import" href="../../app-behaviors/date-behavior.html">

<link rel="import" href="../../../styles/shared-styles.html">

<dom-module id="etools-date-input">

  <template>
    <style include="shared-styles">
      :host {
        width: 235px;
        @apply(--etools-date-input);
      }
      /* TODO: Find a way to separate readonly CSS from shared-styles, and use it here,
      then include it in shared-styles(do not use shared-styles here) */
    </style>

    <paper-input id="dateInput"
                 label="[[label]]"
                 value="[[prettyDate(value)]]"
                 placeholder="[[placeholder]]"
                 on-down="openDatePicker"
                 data-selector="datePickerButton"
                 disabled$="[[disabled]]"
                 readonly$="[[readonly]]"
                 required$="[[required]]"
                 invalid$="[[invalid]]"
                 auto-validate$="[[autoValidate]]"
                 error-message="[[errorMessage]]" validator="[[validator]]">
      <iron-icon prefix icon="date-range" hidden$="[[!readonly]]"></iron-icon>
      <etools-datepicker-button id="datePickerButton"
                                prefix
                                format="[[format]]"
                                pretty-date="{{value}}"
                                json-date="{{jsonValue}}"
                                date="[[prepareDate(value)]]"
                                is-disabled$="[[_disabledDatepicker(readonly, disabled)]]"
                                hidden$="[[readonly]]"
                                no-init="[[noInit]]"
                                show-clear-btn="[[showClearBtn]]">
      </etools-datepicker-button>
    </paper-input>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({

        is: 'etools-date-input',
        behaviors: [
          EtoolsPmpApp.Behaviors.Date
        ],
        properties: {
          label: String,
          value: {
            value: null,
            notify: true
          },
          jsonValue: {
            value: null,
            notify: true
          },
          placeholder: {
            type: String,
            value: 'â€”'
          },
          noInit: Boolean,
          showClearBtn: Boolean,
          readonly: {
            type: Boolean,
            value: false,
            reflectToAttribute: true,
            observer: '_readonlyStateChange'
          },
          disabled: {
            type: Boolean,
            value: false,
            reflectToAttribute: true,
          },
          required: {
            type: Boolean,
            value: false,
            reflectToAttribute: true,
            observer: '_requiredChange'
          },
          autoValidate: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          },
          invalid: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          },
          errorMessage: {
            type: String,
            value: 'Please select a date'
          },
          format: {
            type: String,
            value: 'YYYY-MM-DD'
          },
          validator: String
        },

        _readonlyStateChange: function(newValue, oldValue) {
          this._refreshStyles(newValue, oldValue);
        },
        _requiredChange: function(newValue, oldValue) {
          this._refreshStyles(newValue, oldValue);
        },
        _refreshStyles: function(newVal, oldVal) {
          if (newVal !== oldVal) {
            this.updateStyles();
          }
        },

        _disabledDatepicker: function(readonly, disabled) {
          return readonly || disabled;
        },

        validate: function() {
          return this.$.dateInput.validate();
        }

      });
    })();
  </script>

</dom-module>
