<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">

<dom-module id="etools-progress-bar">
  <template>
    <style>
      :host {
        @apply --layout-horizontal;
        @apply --layout-center;

        --paper-progress-active-color: var(--primary-color);
        --paper-progress-secondary-color: var(--primary-background-color);
        --paper-progress-height: 10px;
      }
      #progress-percent {
        margin-left: 24px;
        min-width: 48px;
      }
      paper-progress {
        @apply --etools-progress-bar;
      }
    </style>
    <paper-progress value="[[progressValue]]"
                    secondary-progress="[[_getSecondaryProgress(progressValue)]]"></paper-progress>
    <span id="progress-percent">[[_prepareDisplayedValue(progressValue)]] %</span>
  </template>

  <script>
    Polymer({
      is: 'etools-progress-bar',
      properties: {
        value: {
          type: Number,
          value: 0
        },
        progressValue: {
          type: Number,
          readOnly: true,
          computed: '_getProgress(value)'
        }
      },

      _getProgress: function(value) {
        value = parseFloat(parseFloat(value).toFixed(2));
        if (Number.isNaN(value)) {
          return 0;
        }
        value = (value > 100) ? 100 : value; // cannot be bigger than 100
        value = (value < 0) ? 0 : value; // cannot be less that 0
        return value;
      },

      /**
       * Secondary progress is used only to show a delimited at the end of the active progress.
       * It will always be 0 (value = 0 || 100) or value + 1
       */
      _getSecondaryProgress: function(value) {
        return (value > 0 && value < 100) ? (value + 1) : 0;
      },

      _prepareDisplayedValue: function(value) {
        return parseFloat(value).toFixed(2);
      }
    });
  </script>
</dom-module>
