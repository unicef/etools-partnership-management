<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/etools-content-panel/etools-content-panel.html">
<link rel="import" href="../../../bower_components/etools-ajax/etools-ajax-request-behavior.html">
<link rel="import" href="../../../bower_components/etools-data-table/etools-data-table.html">
<link rel="import" href="../../app-behaviors/repeatable-data-sets-behavior.html">
<link rel="import" href="../../app-config/app-endpoints-behavior.html">
<link rel="import" href="../static-common-data/redux-behaviors/common-static-data-redux-behavior.html">

<link rel="import" href="../../../styles/grid-layout-styles.html">
<link rel="import" href="../../../styles/repeatable-data-sets-styles.html">

<link rel="import" href="add-edit-disaggregation-dialog.html">

<dom-module id="disaggregation-list">
  <template strip-whitespace>
    <style include="grid-layout-styles repeatable-data-sets-styles data-table-styles">
      :host{
        --header-title: {
          height: 0px !important;
        };
        --data-table-header: {
          height: 54px !important;
        };
      }
    </style>

    <etools-content-panel panel-title="Disaggregations">
      <paper-icon-button slot="panel-btns"
                      icon="add"
                      on-tap="_addDisaggregation">
      </paper-icon-button>
      <etools-data-table-header no-collapse>
        <etools-data-table-column class="col-4" field="name">
           Name
        </etools-data-table-column>
        <etools-data-table-column class="col-8" field="disaggregation_values">
           Disaggregation Groups
        </etools-data-table-column>
      </etools-data-table-header>
      <template is="dom-repeat" items="[[dataItems]]">
        <etools-data-table-row no-collapse>
          <div slot="row-data">
            <span class="col-data col-4">
              [[item.name]]
            </span>
            <span class="col-data col-8">
              [[_displayGroups(item.disaggregation_values)]]
            </span>
          </div>
        </etools-data-table-row>
      </template>
    </etools-content-panel>


 </template>
</dom-module>

<script>
  (function() {
    'use strict';
    Polymer({
      is: 'disaggregation-list',

      behaviors: [
        EtoolsPmpApp.Behaviors.RepeatableDataSets,
        EtoolsPmpApp.Behaviors.Endpoints,
        EtoolsPmpApp.Behaviors.EtoolsDataReduxStore,
        EtoolsAjaxRequestBehavior
      ],

      properties: {
        dataItems: {
          type: Array,
          statePath: 'disaggregations'
        },
        disaggregationModal: {
          type: Object
        },
      },
      ready: function() {
        this.editMode = true;
        this.disaggregationModal = document.createElement('add-edit-disaggregation-dialog');
        this.disaggregationModal.setAttribute('id', 'disaggregationModal');
        Polymer.dom(document.querySelector('body')).appendChild(this.disaggregationModal);
      },

      detached: function() {
        if (this.disaggregationModal) {
          Polymer.dom(document.querySelector('body')).removeChild(this.disaggregationModal);
        }
      },
      _openModal: function() {
        this.disaggregationModal.toastEventSource = this;
        this.disaggregationModal.resetValidations();
        this.disaggregationModal.open();
      },
      _displayGroups: function(groups) {
        if (!groups || !groups.length) {
          return '-';
        }
        return groups.map(function(g){
          return g.value;
        }).join('; ');
      },
      _addDisaggregation: function() {
        this.disaggregationModal.initializeDisaggregation();
        this._openModal();
      }

    });
  })();
</script>

