<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/etools-content-panel/etools-content-panel.html">

<link rel="import" href="../../../styles/buttons-styles.html">

<dom-module id="agreement-status">
  <template>
    <style include="buttons-styles">
      [hidden] {
        display: none !important;
      }

      :host {
        width: 100%;
      }

      etools-content-panel {
        width: 100%;
        --ecp-content: {
          padding: 25px 25px 0;
        };
      }

      .status-container {
        @apply(--layout-horizontal);
      }

      .status-container,
      .divider {
        height: 40px;
      }

      .divider {
        @apply(--layout-vertical);
        width: 100%;
      }

      .divider .status-divider {
        height: 100%;
        width: 11px;
        border-right: 1px solid var(--darker-divider-color);
      }

      .status-icon, .status {
        @apply(--layout-vertical);
        @apply(--layout-center-justified);
        @apply(--layout-warp);
      }

      .status {
        margin-left: 10px;
      }

      .icon-wrapper {
        background-color: #9D9D9D; /* TODO: replace with app-theme var */
        @apply(--layout-vertical);
        @apply(--layout-center-justified);
        width: 24px;
        height: 24px;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        border-radius: 50%;
        color: #ffffff;
      }

      .icon-wrapper iron-icon {
        --iron-icon-height: 16px;
        --iron-icon-width: 16px;
      }

      .icon-wrapper iron-icon,
      .icon-wrapper span {
        @apply(--layout-self-center);
      }

      .icon-wrapper span {
        height: 14px;
        line-height: 14px;
      }

      .status {
        margin-top: 15px;
        margin-bottom: 15px;
        text-transform: capitalize;
        color: #9D9D9D; /* TODO: replace with app-theme var */
      }
      .status-container.active .status {
        cursor: pointer;
      }
      .status-container.active .icon-wrapper {
        background-color: #3A94FF; /* TODO: replace with app-theme var */
      }

      .status-container.active.suspended .icon-wrapper {
        background-color: #F7A14B; /* TODO: replace with app-theme var */
      }

      .status-container.active.suspended .icon-wrapper {
        width: 30px;
        height: 30px;
      }

      .status-container.active.suspended .icon-wrapper,
      .status-container.active.terminated .icon-wrapper {
        background-color: transparent;
      }

      .status-container.active.suspended .icon-wrapper iron-icon,
      .status-container.active.terminated .icon-wrapper iron-icon,
      .status-container.completed .icon-wrapper iron-icon {
        --iron-icon-height: 100%;
        --iron-icon-width: 100%;
      }

      .status-container.active.suspended .icon-wrapper iron-icon {
        background-color: #fff;
        color: #F7A14B; /* TODO: replace with app-theme var */
        margin-left: -6px;
        width: 100%;
        height: 100%;
      }

      .status-container.active.terminated .icon-wrapper iron-icon {
        color: #E54F2E; /* TODO: replace with app-theme var */
      }

      .status-container.active .status,
      .status-container.completed .status {
        color: inherit;
        font-weight: bold;
      }

      .buttons-section {
        margin: 25px -25px 0 -25px;
      }
      .status-container.completed .icon-wrapper {
        background: #75c300; /* TODO: replace with app-theme var */;
      }
      .status-container.completed .icon-wrapper .status-nr,
      .status-container:not(.completed) iron-icon[icon="check"] {
        display: none;
      }

      iron-icon[icon="check"] {
        color: #fff;
      }
      iron-icon[icon="report-problem"] {
        --iron-icon-height: 24px;
        --iron-icon-width: 24px;
      }

    </style>

    <etools-content-panel title="Status">

      <div class$="status-container [[_getFirstStatusWrapperClass(status)]]">
        <div class="status-icon">
            <span class="icon-wrapper">
              <span class="status-nr">1</span>
              <iron-icon icon="check"></iron-icon>
            </span>
        </div>
        <div class="status">
          <span hidden$="[[!_showDraft(status)]]" on-tap="_updateStatus" data-status="cancelled">Draft</span>
          <span hidden$="[[!_showCanceled(status)]]" on-tap="_updateStatus" data-status="draft">Cancelled</span>
        </div>
      </div>
      <div class="divider">
        <div class="status-divider"></div>
      </div>
      <div class$="status-container [[_getSecondStatusWrapperClass(status)]]">
        <div class="status-icon">
            <span class="icon-wrapper">
              <span class="status-nr" hidden$="[[!_showActive(status)]]">2</span>
              <iron-icon icon="av:pause-circle-filled" hidden$="[[!_showSuspended(status)]]"></iron-icon>
              <iron-icon icon="report-problem" hidden$="[[!_showTerminated(status)]]"></iron-icon>
            </span>
        </div>
        <div class="status">
          <span hidden$="[[!_showActive(status)]]" on-tap="_updateStatus" data-status="suspended">Active</span>
          <span hidden$="[[!_showSuspended(status)]]" on-tap="_updateStatus" data-status="terminated">Suspended</span>
          <span hidden$="[[!_showTerminated(status)]]" on-tap="_updateStatus" data-status="active">Terminated</span>
        </div>
      </div>
      <div class="divider">
        <div class="status-divider"></div>
      </div>
      <div class$="status-container [[_getThirdStatusWrapperClass(status)]]">
        <div class="status-icon">
            <span class="icon-wrapper">
              <span>3</span>
            </span>
        </div>
        <div class="status">
          <span>Ended</span>
        </div>
      </div>

      <template is="dom-if" if="[[showSaveBtn]]">
        <div class="buttons-section">
          <paper-button class="primary-btn w100" on-tap="_triggerAgreementSave">SAVE</paper-button>
        </div>
      </template>

    </etools-content-panel>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'agreement-status',

        properties: {
          newAgreement: {
            type: Boolean,
            value: false
          },
          status: {
            type: String,
            value: 'draft'
          },
          showSaveBtn: {
            type: Boolean,
            value: true
          }
        },

        _getFirstStatusWrapperClass: function(status) {
          if (['draft', 'cancelled'].indexOf(status) > -1) {
            return 'active'
          }
          return 'completed';
        },

        _getSecondStatusWrapperClass: function(status) {
          if (['active', 'suspended', 'terminated'].indexOf(status) > -1) {
            return 'active' + ((status !== 'active') ? (' ' + status) : '');
          } else {
            if (['draft', 'cancelled'].indexOf(status) === -1) {
              return 'completed';
            }
          }
          return '';
        },

        _getThirdStatusWrapperClass: function(status) {
          if (status === 'ended') {
            return 'active'
          }
          return '';
        },

        _showDraft: function(status) {
          if(status === 'draft' || !this._showCanceled(status)) {
            return true;
          }
          return false;
        },

        _showCanceled: function(status) {
          return status === 'cancelled';
        },

        _showActive: function(status) {
          if (status === 'active' || (status !== 'suspended' && status !== 'terminated')) {
            return true;
          }
          return false;
        },
        _showSuspended: function(status) {
          if (status === 'suspended') {
            return true;
          }
          return false;
        },
        _showTerminated: function(status) {
          if (status === 'terminated') {
            return true;
          }
          return false;
        },

        _updateStatus: function(event) {
          var newStatus = Polymer.dom(event).localTarget.getAttribute('data-status');

          if (newStatus === 'draft' || newStatus === 'canceled') {
            // if agreement was not saved (is new) or the status is already changed
            // from draft/canceled, stop status change
            if (this.newAgreement || (this.status !== 'draft' && this.status !== 'cancelled')) {
              return false;
            }
          }
          if (newStatus === 'active' || newStatus === 'suspended' || newStatus === 'terminated') {
            if (this.newAgreement || (this.status !== 'active' && this.status !== 'suspended'
                && this.status !== 'terminated')) {
              return false;
            }
          }
          this.set('status', newStatus);
          console.log(newStatus);
        },


      });
    })();

  </script>
</dom-module>
