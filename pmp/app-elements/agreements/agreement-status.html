<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/etools-content-panel/etools-content-panel.html">

<link rel="import" href="../../../styles/buttons-styles.html">

<dom-module id="agreement-status">
  <template>
    <style include="buttons-styles">
      [hidden] {
        display: none !important;
      }

      :host {
        width: 100%;
      }

      etools-content-panel {
        width: 100%;
        --ecp-content: {
          padding: 25px 25px 0;
        };
      }

      .status-container {
        @apply(--layout-horizontal);
      }

      .status-container,
      .divider {
        height: 40px;
      }

      .divider {
        @apply(--layout-vertical);
        width: 100%;
      }

      .divider .status-divider {
        height: 100%;
        width: 11px;
        border-right: 1px solid var(--darker-divider-color);
      }

      .status-icon, .status {
        @apply(--layout-vertical);
        @apply(--layout-center-justified);
        @apply(--layout-warp);
      }

      .status {
        margin-left: 10px;
      }

      .icon-wrapper {
        background-color: #9D9D9D; /* TODO: replace with app-theme var */
        @apply(--layout-vertical);
        @apply(--layout-center-justified);
        width: 24px;
        height: 24px;
        -webkit-border-radius: 50%;
        -moz-border-radius: 50%;
        border-radius: 50%;
        color: #ffffff;
      }

      .icon-wrapper iron-icon {
        --iron-icon-height: 16px;
        --iron-icon-width: 16px;
      }

      .icon-wrapper iron-icon,
      .icon-wrapper span {
        @apply(--layout-self-center);
      }

      .icon-wrapper span {
        height: 14px;
        line-height: 14px;
      }

      .status {
        text-transform: capitalize;
        color: #9D9D9D; /* TODO: replace with app-theme var */
      }

      .status-container.active .icon-wrapper {
        background-color: #3A94FF; /* TODO: replace with app-theme var */
      }

      .status-container.active.suspended .icon-wrapper {
        background-color: #F7A14B; /* TODO: replace with app-theme var */
      }

      .status-container.active.suspended .icon-wrapper {
        width: 30px;
        height: 30px;
      }

      .status-container.active.suspended .icon-wrapper,
      .status-container.active.terminated .icon-wrapper {
        background-color: transparent;
      }

      .status-container.active.suspended .icon-wrapper iron-icon,
      .status-container.active.terminated .icon-wrapper iron-icon {
        --iron-icon-height: 100%;
        --iron-icon-width: 100%;
      }

      .status-container.active.suspended .icon-wrapper iron-icon {
        background-color: #fff;
        color: #F7A14B; /* TODO: replace with app-theme var */
        margin-left: -6px;
        width: 100%;
        height: 100%;
      }

      .status-container.active.terminated .icon-wrapper iron-icon {
        color: #E54F2E; /* TODO: replace with app-theme var */
      }

      .status-container.active .status,
      .status-container.completed .status {
        color: inherit;
        font-weight: bold;
      }

      .buttons-section {
        margin: 25px -25px 0 -25px;
      }

    </style>

    <etools-content-panel title="Status">

      <template is="dom-repeat" items="[[statuses]]">
        <div class$="status-container [[item.statusClass]]">
          <div class="status-icon">
            <span class="icon-wrapper">
              <iron-icon icon$="[[item.icon]]" hidden$="[[!item.showIcon]]"></iron-icon>
              <span hidden$="[[item.showIcon]]">[[item.statusNr]]</span>
            </span>
          </div>
          <div class="status">
            <p>[[item.statusText]]</p>
          </div>
        </div>
        <template is="dom-if" if="[[_showDivider(index)]]">
          <div class="divider">
            <div class="status-divider"></div>
          </div>
        </template>
      </template>

      <template is="dom-if" if="[[showSaveBtn]]">
        <div class="buttons-section">
          <paper-button class="primary-btn w100" on-tap="_triggerAgreementSave">SAVE</paper-button>
        </div>
      </template>

    </etools-content-panel>


  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'agreement-status',

        properties: {
          status: {
            type: String,
            value: 'draft'
          },
          showSaveBtn: {
            type: Boolean,
            value: true
          }
        },

        ready: function() {
          // prepare statuses properties
          var statuses = [
            {
              statusClass: (this.status === 'draft') ? 'active' : 'completed',
              icon: 'done',
              showIcon: (this.status === 'draft') ? false : true,
              statusNr: '1',
              statusText: 'Draft'
            },
            {
              statusClass: this._getStatusClass(),
              icon: this._getSecondStatusCategoryIcon(),
              showIcon: this._showSecondStatusCategoryIcon(),
              statusNr: '2',
              statusText: !this._isSecondStatusCategory() ? 'Active' : this.status
            },
            {
              statusClass: (this.status === 'expired') ? 'active' : '',
              icon: '',
              showIcon: false,
              statusNr: '3',
              statusText: 'Expired'
            }
          ];
          this.set('statuses', statuses);
        },

        _showDivider: function(index) {
          return index < 2;
        },

        /**
         * Fire custom event to notify parent element to execute agreement save
         */
        _triggerAgreementSave: function() {
          this.fire('save-agreement', {});
        },

        /**
         * Second status category values can be: active, suspended and terminated
         */
        _isSecondStatusCategory: function() {
          return this.status === 'active' || this.status === 'suspended' || this.status === 'terminated';
        },

        /**
         * Show second status category icon only for: suspended and terminated
         */
        _showSecondStatusCategoryIcon: function() {
          if (['active', 'draft', 'expired'].indexOf(this.status) > -1) {
            return false;
          }
          return true;
        },

        /**
         * Get suspended and terminated icon names
         */
        _getSecondStatusCategoryIcon: function() {
          if (this.status === 'suspended') {
            return 'av:pause-circle-filled';
          }
          if (this.status === 'terminated') {
            return 'report-problem';
          }
          return '';
        },

        /**
         * Get status element class
         */
        _getStatusClass: function() {
          var statusClass = '';
          if (this._isSecondStatusCategory()) {
            statusClass += 'active';
            if (this.status !== 'active') {
              statusClass += ' ' + this.status;
            }
          } else {
            if (this.status !== 'draft') {
              statusClass += ' was-active';
            }
          }
          return statusClass;
        }

      });
    })();

  </script>
</dom-module>
