<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<script>
  window.pmpBehaviors = window.pmpBehaviors || {};
  /** @polymerBehavior pmpBehaviors.AgreementAmendmentsBehavior */
  pmpBehaviors.AgreementAmendmentsBehavior = {

    getOfficerName: function(officerId, staffMembers) {
      if (staffMembers instanceof Array && staffMembers.length > 0) {
        var officer = staffMembers.filter(function(o) {
          return parseInt(o.id, 10) === parseInt(officerId, 10);
        })[0];
        if (officer) {
          return officer.name;
        }
      }
      return 'Officer not found in staff members list';
    },

    prepareAttachementFile: function(filePath) {
      if (typeof filePath === 'string' && filePath !== '') {
        return [{
          id: null,
          file_name: filePath.substr(filePath.lastIndexOf('/') + 1),
          path: filePath
        }];
      }
      return [];
    },

    _checkAndPrepareAmendmentTypeStr: function(typeStr) {
      if (typeof typeStr === 'string') {
        return typeStr.toLowerCase();
      }
      return '';
    },

    showAmendmentTypeOfficer: function(amendmentTypeStr) {
      return this._checkAndPrepareAmendmentTypeStr(amendmentTypeStr) === 'change authorized officer';
    },

    showAmendmentTypeBankInfo: function(amendmentTypeStr) {
      return this._checkAndPrepareAmendmentTypeStr(amendmentTypeStr) === 'change banking info';
    },

    showAmendmentTypeLegalNameOfIp: function(amendmentTypeStr) {
      return this._checkAndPrepareAmendmentTypeStr(amendmentTypeStr) === 'change ip name';
    },

    showAmendmentTypeExtensionProgrammeCycle: function(amendmentTypeStr) {
      return this._checkAndPrepareAmendmentTypeStr(amendmentTypeStr) === 'cp extension';
    },

    showAmendmentTypeAdditionalClauses: function(amendmentTypeStr) {
      return this._checkAndPrepareAmendmentTypeStr(amendmentTypeStr) === 'additional clause';
    },

    showAmendmentTypeExistingClauseAmended: function(amendmentTypeStr) {
      return this._checkAndPrepareAmendmentTypeStr(amendmentTypeStr) === 'amend existing clause';
    },

    validAmendmentType: function(amendmentType, index) {
      var validation = {result: true, elementId: null};
      if (this.showAmendmentTypeOfficer(amendmentType.type)) {
        if (amendmentType.officer_id === null) {
          validation.result = false;
          validation.elementId = (index >= 0) ? ('officersDropdown_' + index) : null;
        }
      }

      if (this.showAmendmentTypeAdditionalClauses(amendmentType.type)) {
        if (amendmentType.additional_clauses === null || amendmentType.additional_clauses === '') {
          validation.result = false;
          validation.elementId = (index >= 0) ? ('additionalClause_' + index) : null;
        }
      }

      if (this.showAmendmentTypeExistingClauseAmended(amendmentType.type)) {
        if (amendmentType.existing_clause_amended === null || amendmentType.existing_clause_amended === '') {
          validation.result = false;
          validation.elementId = (index >= 0) ? ('existingClauseAmended_' + index) : null;
        }
      }

      return validation;
    }

  };
</script>
