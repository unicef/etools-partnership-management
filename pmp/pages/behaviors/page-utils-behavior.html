<script>
  window.pmpBehaviors = window.pmpBehaviors || {};
  /** @polymerBehavior pmpBehaviors.PageUtilsBehavior */
  pmpBehaviors.PageUtilsBehavior = {

    properties: {
      _ignoreFirstTabSelectEvent: Boolean,
      _subPageOrTabAttached: {
        type: Boolean,
        value: false
      }
    },

    _pageEquals: function(activePage, expectedPage) {
      return activePage === expectedPage;
    },

    _triggerPageNotFound: function() {
      this.fire('404');
    },

    _removeStrDash: function(str) {
      return str.replace(new RegExp('-', 'g'), ' ');
    },

    _showPageTabs: function(page) {
      return page !== 'list';
    },

    _getTopContentAdditionalClass: function(page) {
      if (this._showPageTabs(page)) {
        return 'with-tabs';
      }
      return '';
    },

    _importPageElement: function(page, pagePrefix, pageBaseUrl) {
      if (page) {
        let pageName = pagePrefix + page;
        if (!Polymer.isInstance(this.$$(pageName))) {
          let resolvedPageUrl = this.resolveUrl(pageBaseUrl + pageName + '.html');
          this.importHref(resolvedPageUrl, null, this._triggerPageNotFound, true);
        }
      }
    },

    _showTabChangeLoadingMsg: function(e, loadingSource, tabPrefix) {
      if (!this._ignoreFirstTabSelectEvent) {
        let clickedTabName = e.detail.item.getAttribute('name');
        if (Polymer.isInstance(this.$$(tabPrefix + clickedTabName))) {
          // tab element already loaded, no need for loading messages
          return;
        }
        this.fire('global-loading', {
          message: 'Loading ' + this._removeStrDash(clickedTabName) + ' page elements...',
          active: true,
          loadingSource: loadingSource
        });
      } else {
        this.set('_ignoreFirstTabSelectEvent', false);
      }
    },

    /**
     * "other" can be any property that must be defined before the method is executed
     */
    _showSidebarStatus: function(listPageActive, subPageOrTabAttached, other) {
      let showStatus = !listPageActive && !!subPageOrTabAttached;
      return !other ? showStatus : (showStatus && other);
    },

    _handlePageTabAttached: function(e) {
      e.stopImmediatePropagation();
      // just a flag to know when to show sidebar status element
      this.set('_subPageOrTabAttached', true);
    }

  };
</script>
