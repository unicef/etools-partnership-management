<!--
App global configuration
-->
<link rel="import" href="../../bower_components/etools-dexiejs/etools-dexiejs.html">
<link rel="import" href="../../scripts/lodash/lodash.html">

<script>
    'use strict';

    /**
     * for db versioning check
     * https://github.com/dfahlander/Dexie.js/wiki/Design#database-versioning
     */
    var etoolsCustomDexieDb = new Dexie('pmpApp');
    etoolsCustomDexieDb.version(1).stores({
      collectionsList: '&name, expire',
      countries: 'id, name',
      partners: 'id, name, rating',
      user: 'id'
    });

    var etoolsAppConfig = {
      db: etoolsCustomDexieDb,

      // globals
      globals: {

        baseSite: window.location.origin,
        basePath: (window.location.port === '8080') ? '/' : '/pmp/',
        serverBackend: (window.location.port !== '8080'),

        getEndpoint: function(endpointName, data) {
          var endpoint = etoolsAppConfig.endpoints[endpointName];
          if (endpoint && endpoint.hasOwnProperty('template') && endpoint.template !== '') {
            endpoint.url = this.baseSite + _.template(endpoint.template)(data);
          }
          return endpoint;
        },

        getAllPermissions: function() {
          return etoolsAppConfig.permissions;
        }
      },

      // permissions
      permissions: {
        superPermissions: ['loggedInDefault', 'userInfoMenu',
                           'interventionsMenu', 'statsMenu'], //for testing
        partnerOnlyPermissions: ['interventionsMenu'],
        defaultPermissions: ['loggedInDefault','userInfoMenu'],
        partnerPermissions: ['interventionsMenu'],
        managementPermissions: ['statsMenu']
      }
    };
    var localEndpoints = {
        user: {
            url: '/users/api/profile/',
            exp: 30 * 60 * 1000, // 30min
            cachingKey: 'user'
        },
        agreements: {
            template: '/management/api/stats/agreements/',
            exp: 30 * 60 * 1000, // 30min
            cachingKey: 'agreements'
        },
        countries: {
            url: '../../data/countries.json',
            exp: 6 * 60 * 60 * 1000, // 6h
            cachingKey: 'countries'
        },
        partners: {
            url: '../../data/partners.json',
            exp: 6 * 60 * 60 * 1000, // 6h
            cachingKey: 'partners'
        }
    };
    var serverEndpoints = {
        user: {
            url: '/users/api/profile/',
            exp: 30 * 60 * 1000, // 30min
            cachingKey: 'user'
        },
        agreements: {
            template: '/management/api/stats/agreements/',
            exp: 30 * 60 * 1000, // 30min
            cachingKey: 'agreements'
        },
        countries: {
            url: '../../data/countries.json',
            exp: 6 * 60 * 60 * 1000, // 6h
            cachingKey: 'countries'
        },
        partners: {
            url: '../../data/partners.json',
            exp: 6 * 60 * 60 * 1000, // 6h
            cachingKey: 'partners'
        }
    };

    etoolsAppConfig.endpoints = etoolsAppConfig.globals.serverBackend ? serverEndpoints : localEndpoints

</script>
