<!--
App global configuration
-->
<link rel="import" href="../../bower_components/etools-dexiejs/etools-dexiejs.html">
<link rel="import" href="../../scripts/lodash/lodash.html">

<script>
    'use strict';

    /**
     * for db versioning check
     * https://github.com/dfahlander/Dexie.js/wiki/Design#database-versioning
     */
    var etoolsCustomDexieDb = new Dexie('pmpApp');
    etoolsCustomDexieDb.version(1).stores({
      collectionsList: 'name, expire',
      countries: 'id',
      partners: 'id, name, rating, vendor_number',
      agreements: 'id, agreement_number, agreement_type, partner_name, start, end, status',
      interventions: 'id, number, partner_name, document_type, ' +
        'cp_outputs, status, title, start, end, sectors, unicef_focal_points, offices',
      user: 'id'
    });
    /** @polymerBehavior etoolsAppConfig.globals */
    var etoolsAppConfig = {

      db: etoolsCustomDexieDb,

      // globals

      globals: {
        baseSite: window.location.origin,
        basePath: (window.location.port === '8080') ? '/' : '/pmp/',
        serverBackend: (window.location.port !== '8080'),
        loginPath: window.location.origin + '/login/',

        getEndpoint: function(endpointName, data) {
          var endpoint = JSON.parse(JSON.stringify(etoolsAppConfig.endpoints[endpointName]));
          if (endpoint && endpoint.hasOwnProperty('template') && endpoint.template !== '') {
            endpoint.url = this.baseSite + _.template(endpoint.template)(data);
          }
          return endpoint;
        },

        getAllPermissions: function() {
          return etoolsAppConfig.permissions;
        }
      },

      // permissions
      permissions: {
        defaultPermissions: [
          'loggedInDefault',
          'userInfoMenu',
          'viewPartnerDetails',
          'viewAgreementDetails',
          'viewInterventionDetails',
        ],
        unicefUserPermissions: [
          'editInterventionDetails'
        ],
        superPermissions: [
          'loggedInDefault',
          'userInfoMenu',
          'interventionsMenu',
          'statsMenu',
          'viewPartnerDetails',
          'editPartnerDetails',
          'viewAgreementDetails',
          'editAgreementDetails',
          'viewInterventionDetails',
          'editInterventionDetails'
        ],
        partnershipManagerPermissions: [
          'partnershipManager',
          'editPartnerDetails',
          'editAgreementDetails',
        ],
        PMEPermissions: [
          'PME'
        ],
        ICTPermissions: [
          'ICT'
        ]
      }
    };

    var localEps = {
//      changeCountry: {
//        url: '/users/api/changecountry/'
//      },
      // TODO: endpoint(might be changed) should return etools(List of Staff) WHERE Group = "Senior Management"
      unicefUsers: {
        url: '../../data/users-api.json',
        exp: 60 * 60 * 1000, // 1h
        cachingKey: 'unicefUsers'
      },
      user: {
        url: '../../data/users-api-profile.json',
        exp: 30 * 60 * 1000, // 30min
        cachingKey: 'user'
      },
      agreements: {
        url: '../../data/agreements.json',
        exp: 30 * 60 * 1000, // 30min
        cachingKey: 'agreements'
      },
      agreementDetails: {
        url: '../../data/agreement-details.json',
      },
      countries: {
        url: '../../data/countries.json', // API request receives a 404 for now
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'countries'
      },
      partners: {
        url: '../../data/partners.json',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'partners'
      },
      partnerDetails: {
        url: '../../data/partner_details.json',
        // exp: 6 * 1000, // 6 sec
        // if this caching key is missing then the data will be cached with the url as key
        // cachingKey: 'partnerDetails'
      },
      interventions: {
        url: '../../data/interventions.json',
        exp: 5 * 60 * 1000, // 5min
        cachingKey: 'interventions'
      },
      interventionDetails: {
        url: '../../data/intervention-detail.json',
      },
      dropdownsPmp: {
        url: '../../data/dropdowns-pmp.json',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'dropdownsPmp'
      },
      dropdownsStatic: {
        url: '../../data/dropdowns-static.json',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'dropdownsStatic'
      },
      sectors: {
        url: '../../data/sectors.json',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'sectors'
      },
      locations: {
        url: '../../data/locations-lite.json',
        exp: 60 * 60 * 60 * 1000, // 60h
        cachingKey: 'locations'
      },
      offices: {
        url: '../../data/offices.json',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'offices'
      }
    };

    var serverEps = {
      changeCountry: {
        url: '/users/api/changecountry/'
      },
      // TODO: endpoint(might be changed) should return etools(List of Staff) WHERE Group = "Senior Management"
      unicefUsers: {
        url: '/users/api/',
        exp: 60 * 60 * 1000, // 1h
        cachingKey: 'unicefUsers'
      },
      user: {
        url: '/users/api/profile/',
        exp: 30 * 60 * 1000, // 30min
        cachingKey: 'user'
      },
      agreements: {
        template: '/api/v2/agreements/',
        exp: 30 * 60 * 1000, // 30min
        cachingKey: 'agreements'
      },
      agreementDetails: {
        template: '/api/v2/agreements/<%=id%>/',
      },
      partnerAssessmentDelete: {
        template: '/api/v2/partners/assessments/<%=id%>/',
      },
      interventionResultLinkDelete: {
        template: '/api/v2/interventions/results/<%=id%>/',
      },
      agreementAmendmentsDelete: {
        template: '/api/v2/agreements/amendments/<%=id%>/',
      },
      agreementAmendmentsTypeDelete:  {
        template: '/api/v2/agreements/amendments/types/<%=id%>/',
      },
      lowerResultsDelete:  {
        template: '/api/v2/reports/lower_results/<%=id%>/',
      },
      myProfile:  {
        template: '/api/v2/users/myprofile/',
      },
      countries: {
        url: '/api/countries/', // API request receives a 404 for now
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'countries'
      },
      partners: {
        url: '/api/v2/partners/',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'partners'
      },
      partnerDetails: {
        template: '/api/v2/partners/<%=id%>/',
        // exp: 6 * 1000, // 6 sec
        // if this caching key is missing then the data will be cached with the url as key
        // cachingKey: 'partnerDetails'
      },
      createPartner: {
        template: '/api/v2/partners/add/?vendor=<%=vendor%>',
      },
      deletePartner: {
        template: '/api/v2/partners/delete/<%=id%>/',
      },
      partnerStaffMembers: {
        template: '/api/v2/partners/<%=id%>/staff-members/',
      },
      interventions: {
        url: '/api/v2/interventions/',
        exp: 10 * 60 * 1000, // 5min
        cachingKey: 'interventions'
      },
      interventionDetails: {
        template: '/api/v2/interventions/<%=id%>/',
      },
      dropdownsPmp: {
        url: '/api/v2/dropdowns/pmp',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'dropdownsPmp'
      },
      dropdownsStatic: {
        url: '/api/v2/dropdowns/static',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'dropdownsStatic'
      },
      sectors: {
        url: '/api/reports/sectors',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'sectors'
      },
      locations: {
        url: '/api/locations',
        exp: 60 * 60 * 60 * 1000, // 60h
        cachingKey: 'locations'
      },
      offices: {
        url: '/api/offices',
        exp: 6 * 60 * 60 * 1000, // 6h
        cachingKey: 'offices'
      },
      // TODO: might not be needed, gov in simple removed
      countryProgrammes: {
        cachingKey: 'countryProgrammes',
        exp: 5 * 60 * 1000, // 5min
        url: '/api/v2/reports/countryprogramme/'
      },
      sections: {
          url: '/api/sections',
          exp: 6 * 60 * 60 * 1000,
          cachingKey: 'sections'
      },
      ramIndicators: {
        template: '/api/v2/reports/results/<%=id%>/indicators/',
      },
      monitoringVisits: {
        template: '/api/t2f/travels/activities/partnership/<%=id%>/',
      },
      sectorLocationsDelete: {
        template: '/api/v2/interventions/sector-locations/<%=id%>/'
      },
      cpOutputsByIdsAsValues: {
        // it's gonna be used for getting old cp outputs for esmm dropdown
        url: '/api/v2/reports/results'
      },
      frNumbersDetails: {
        url: '/api/v2/funds/frs'
      }
    };
    /* jshint ignore:start */
    etoolsAppConfig.endpoints = etoolsAppConfig.globals.serverBackend ? serverEps : localEps;

    window.EtoolsLogsLevel = window.EtoolsLogsLevel || 'WARN';
    /* jshint ignore:end */

</script>
