<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

  <title>Partners Pages Tests</title>

  <script src="../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../bower_components/web-component-tester/browser.js"></script>
  <script src="../../../node_modules/redux/dist/redux.min.js"></script>

  <script src="../../../bower_components/iron-test-helpers/mock-interactions.js"></script>

  <link rel="import" href="../../../pmp/app-config/app-dexie-db-config.html">
  <link rel="import" href="../../test-helpers/testing-utils.html">
  <link rel="import" href="../../test-helpers/users-and-permissions-data-mockup.html">

  <link rel="import" href="partners.page-object.html">

  <!-- Import the element to test -->
  <link rel="import" href="../../../pmp/pages/page-partners.html">

</head>
<body>

  <test-fixture id="partners">
    <template>
      <page-partners></page-partners>
    </template>
  </test-fixture>

  <script>

    (function() {
      'use strict';

      suite('Main partners page tests', function() {
        let partners;
        let partnersPage;

        let defaultRoute = {
          prefix: '',
          path: 'partners/list',
          '__queryParams': {size: 10, sort :'name.asc'}
        };

        setup(function() {
          // setup main partners page test-fixture
          partners = fixture('partners');

          partnersPage = new PartnersPage(partners);

//          partners.set('route', defaultRoute);
//          partners.set('partnerPage', 'list');
//          partners.set('listActive', true);
        });

        test('Main element: page-partners is registered', function() {
          assert.equal(partners.is, 'page-partners');
        });

        test('Test page routes', (done) => {
          flush(() => {
            partnersPage.updateProperties({currentPage: 'partners', route: defaultRoute});
            console.log(partners.tab, partners.routeData);
            expect(partners.route.path).to.equal('partners/list');
            expect(partners.get('partnerPage')).to.equal('list');

            done();
          });
        });

//        test('Default active page should be partners list', function(done) {
//          flush(function() {
//            expect(partners.route.path).to.equal('partners/list');
//            expect(partners.get('partnerPage')).to.equal('list');
//            expect(partners._pageEquals(partners.partnerPage, 'list')).to.equal(true);
//            expect(partners.listActive).to.equal(true);
//            expect(partners.tabsActive).to.equal(false);
//
//            let titleEl = PmpTestsHelper.shadowDomQuery(partners, 'h1[main-title]');
//            let titleText = String(PmpTestsHelper.domQuery(titleEl, 'span:not([hidden])').innerHTML);
//            expect(titleText).to.equal('Partners');
//            done();
//          });
//        });
//
//        test('Test add new partner: add dialog, vendor field validation, create-partner event data', function(done) {
//          flush(function() {
//            let newPartnerEl = partners.newPartnerDialog;
//            expect(newPartnerEl.is).to.equal('new-partner-dialog');
//
//            let newPartnerDialog = PmpTestsHelper.shadowDomQuery(newPartnerEl, '#newPartnerDialog');
//            expect(newPartnerDialog.is).to.equal('etools-dialog');
//            expect(newPartnerDialog.dialogTitle).to.equal('New Partner');
//
//            let vendorEl = newPartnerDialog.querySelector('#vendorNo');
//
//            let addNewPartnerBtn = PmpTestsHelper.shadowDomQuery(partners, '#addNewPartner');
//            MockInteractions.tap(addNewPartnerBtn);
//
//            expect(newPartnerDialog.opened).to.equal(true);
//            expect(vendorEl.invalid).to.equal(false);
//            expect(vendorEl.errorMessage).to.equal('Vendor# is required');
//
//            let dialogSaveBtn = PmpTestsHelper.shadowDomQuery(newPartnerDialog, 'paper-button[dialog-confirm]');
//            expect(dialogSaveBtn.hasAttribute('disabled')).to.equal(true);
//
//            vendorEl.validate();
//            expect(vendorEl.invalid).to.equal(true);
//
//            let vendorMock = '345345';
//            vendorEl.set('value', vendorMock);
//            expect(vendorEl.invalid).to.equal(false);
//            expect(dialogSaveBtn.hasAttribute('disabled')).to.equal(false);
//
//            partners.addEventListener('create-partner', function(e) {
//              expect(e.detail.vendor).to.equal(vendorMock);
//              done();
//            });
//            MockInteractions.tap(dialogSaveBtn);
//          });
//        });

      });
    })();
  </script>

</body>
</html>

