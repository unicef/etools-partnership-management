<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

  <title>Partners Pages Tests</title>

  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../bower_components/web-component-tester/browser.js"></script>
  <script src="../../node_modules/redux/dist/redux.min.js"></script>

  <link rel="import" href="../../pmp/app-config/app-dexie-db-config.html">
  <link rel="import" href="../test-helpers/testing-utils.html">
  <link rel="import" href="../test-helpers/users-and-permissions-data-mockup.html">

  <!-- Import the element to test -->
  <link rel="import" href="../../pmp/pages/page-partners.html">

</head>
<body>

  <test-fixture id="partners">
    <template>
      <page-partners></page-partners>
    </template>
  </test-fixture>

  <script>

    suite('Main partners page tests', function() {
      let server;
      let partners;

      let defaultRoute = {
        prefix: '',
        path: 'partners/list',
        '__queryParams': {size: 10, sort :'name.asc'}
      };

      setup(function() {
        server = PmpTestsHelper.initializeFakeServer();
        // setup main partners page test-fixture
        partners = fixture('partners');
        partners.set('route', defaultRoute);
        partners.set('partnerPage', 'list');
        partners.set('listActive', true);
      });

      teardown(function() {
        server.restore();
      });

      test('Main partners element: page-partners is registered', function() {
        assert.equal(partners.is, 'page-partners');
      });

      test('Default active page should be partners list', function(done) {
        flush(function() {
          expect(partners.route.path).to.equal('partners/list');
          expect(partners.get('partnerPage')).to.equal('list');
          expect(partners._pageEquals(partners.partnerPage, 'list')).to.equal(true);
          expect(partners.listActive).to.equal(true);
          expect(partners.tabsActive).to.equal(false);

          let titleEl = Polymer.dom(partners.root).querySelector('h1[main-title]');
          let titleText = String(Polymer.dom(titleEl).querySelector('span:not([hidden])').innerHTML);
          expect(titleText).to.equal('Partners');

          Polymer.Base.async(function() {
            let partnersListElement = partners.$$('#list');
            expect(partnersListElement.is).to.equal('partners-list');
            done();
          }, 1000);
        });
      });

    });
  </script>

</body>
</html>

