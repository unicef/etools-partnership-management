<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>Page Reports</title>

    <script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../bower_components/web-component-tester/browser.js"></script>
    <script src="../../node_modules/redux/dist/redux.min.js"></script>

    <!-- <link rel="import" href="../test-helpers/users-and-permissions-data-mockup.html"> -->
    <!-- <link rel="import" href="../../pmp/app-config/app-dexie-db-config.html"> -->
    <link rel="import" href="../test-helpers/testing-utils.html">
    <link rel="import" href="mockup-data/reports-mockup-data.html">
    <link rel="import" href="../../pmp/app-elements/reports/reports-list.html">
  </head>
  <body>
    <test-fixture id="reportsListFixture">
      <template>
        <reports-list></reports-list>
      </template>
    </test-fixture>

    <script>
      suite('reports-list tests', function() {
        var reportsList, reportsDisaplyLis;
        setup(function(done) {
          reportsList = fixture('reportsListFixture');
          console.log('test 1');
          reportsDisplayList = reportsList.$.reportsDisplayList;
          reportsDisplayList.fireRequest = function() {
            return new Promise(function(resolve, reject){
            resolve({results: PmpTests.ReportsMockupData.list});
          });
          };
          PmpTestsHelper.makeDebounceSynchronous(reportsDisplayList);
          reportsDisplayList.currentUser = {email: 'k@email.com'};
          console.log('test 99');

          reportsList.active = true;
          reportsList.queryParams = {
            "pd_ref_title": "",
            "external_partner_id": null,
            "cp_output": null,
            "section": null,
            "status": null
          };
          reportsList.partners = [];
          reportsList.cpOutputs = [];
          reportsList.sections = [];
          reportsList.reportStatuses = [];

          done();
        });
      test('can instantiate reports-list element', function() {
        assert.equal(reportsList.is, 'reports-list');
      });
      test('element is rendered', function(done) {
        flush(function() {
          assert.equal(PmpTestsHelper.elementIsVisible(reportsList), true);

          done();
        });
      });
      test('report list items are diplayed', function(done) {
        flush(function() {
          let rows = reportsDisplayList.$$('#list').querySelectorAll('etools-data-table-row');

          expect(rows.length).to.equal(2);
          expect(reportsDisplayList.reports.length).to.equal(2);
          done();
        });
      });


    });
    </script>
  </body>
</html>

